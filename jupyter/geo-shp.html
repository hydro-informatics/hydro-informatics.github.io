

<!DOCTYPE html>


<html >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Shapefile (Vector) Handling &#8212; Hydro-Informatics</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script src="../_static/tabs.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"TeX": {"Macros": {"N": "\\mathbb{N}", "floor": ["\\lfloor#1\\rfloor", 1], "bmat": ["\\left[\\begin{array}"], "emat": ["\\end{array}\\right]"]}}, "options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'jupyter/geo-shp';</script>
    <link rel="canonical" href="https://hydro-informatics.com/jupyter/geo-shp.html" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Raster (Grid) Handling" href="geo-raster.html" />
    <link rel="prev" title="Geospatial Open Source Python Libraries" href="../geopy/geo-pckg.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="None"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/icon.jpg" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/icon.jpg" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Get Started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../lectures/classroom.html">The Virtual Classroom</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../lectures/principles.html">Principles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lectures/overview.html">Lectures and Exercises</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lectures/take-seat.html">Take a Seat</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../get-started/software.html">Software Resources</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../get-started/vm.html">Virtual Machines and Linux</a></li>

<li class="toctree-l2"><a class="reference internal" href="../get-started/ide.html">Integrated Development Environments (IDEs)</a></li>



<li class="toctree-l2"><a class="reference internal" href="../python-basics/pyinstall.html">Python (Installation)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../get-started/git.html">Version Control : git</a></li>
<li class="toctree-l2"><a class="reference internal" href="../get-started/geo.html">Geospatial Software</a></li>
<li class="toctree-l2"><a class="reference internal" href="../get-started/install-openfoam.html">OpenFOAM (Installation)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../get-started/install-telemac.html">TELEMAC (Installation)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../get-started/others.html">Other Software Resources</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Python Basics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../python-basics/python.html">First Steps</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="pybase.html">Hello Data Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="pyerror.html">Errors, Logging, and Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="pyloop.html">Loops and Conditional Statements</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../python-basics/modularize.html">Object Orientation</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="pyfun.html">Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="pypckg.html">Packages, Modules and Libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="classes.html">Object Orientation and Classes</a></li>

</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../python-basics/data-handling.html">Data and File Handling</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="pynum.html">Data Files, NumPy &amp; Pandas</a></li>





<li class="toctree-l2"><a class="reference internal" href="xml.html">Structured Data (XML, xlsx &amp; JSON)</a></li>

<li class="toctree-l2"><a class="reference internal" href="pyplot.html">Plotting</a></li>

</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="pystyle.html">Code Style and Conventions</a></li>

<li class="toctree-l1"><a class="reference internal" href="gui.html">Graphical User Interfaces (GUIs)</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../exercises/python-exercises.html">Python Exercises</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../exercises/ex-ms.html">1d Hydraulics (Manning-Strickler Formula)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../exercises/ex-sp.html">Reservoir Volume (Sequent Peak Algorithm)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../exercises/ex-floods.html">Flood Return Periods</a></li>
<li class="toctree-l2"><a class="reference internal" href="../exercises/ex-sediment.html">1d Sediment Transport</a></li>
<li class="toctree-l2"><a class="reference internal" href="../exercises/ex-gui.html">Create a GUI</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Geospatial Analysis</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../geopy/geospatial-data.html">Geospatial Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../geopy/use-qgis.html">QGIS Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../geopy/drone-processing.html">Process Drone (UAV) Imagery</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../geopy/geo-python.html">Geospatial Python</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../geopy/geo-pckg.html">Geospatial Open Source Python Libraries</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Shapefile (Vector) Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="geo-raster.html">Raster (Grid) Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="geo-convert.html">Vectorize and Rasterize</a></li>
<li class="toctree-l2"><a class="reference internal" href="geo-arcpy.html">The Commercial arcpy Library</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../exercises/geo-exercises.html">Exercises</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../exercises/ex-geco.html">Script a Habitat Suitability Map</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Numerical Modeling</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../numerics/numerical-modeling.html">Principles</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../numerics/basement/basement.html">BASEMENT</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../numerics/pre-qgis-bm.html">Pre-processing with QGIS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../numerics/basement/basement2d.html">Run and Check a Steady 2d Simulation</a></li>



</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../numerics/telemac/telemac.html">TELEMAC</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../numerics/pre-slf-tm.html">Pre-processing</a></li>


<li class="toctree-l2 has-children"><a class="reference internal" href="../numerics/telemac/telemac2d.html">Telemac2d</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-11"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../numerics/telemac/telemac2d-steady.html">Steady 2d</a></li>



<li class="toctree-l3"><a class="reference internal" href="../numerics/telemac/telemac2d-unsteady.html">Unsteady 2d</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../numerics/telemac/telemac3d.html">Telemac3d</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-12"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../numerics/telemac/telemac3d-slf.html">Steady 3d (SLF - Selafin)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../numerics/telemac/telemac3d-med.html">Steady 3d (MED and Salome)</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../numerics/telemac/telemac-gaia.html">Gaia (Morphodynamics)</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-13"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../numerics/telemac/gaia-coupling.html">Introduction and Coupling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../numerics/telemac/gaia-basics.html">Basic Setup of Gaia</a></li>
<li class="toctree-l3"><a class="reference internal" href="../numerics/telemac/gaia-bedload.html">Bedload</a></li>
<li class="toctree-l3"><a class="reference internal" href="../numerics/telemac/gaia-suspended.html">Suspended Load</a></li>
<li class="toctree-l3"><a class="reference internal" href="../numerics/telemac/gaia-run.html">Run and Analyze</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../numerics/telemac/mass-balance-bc.html">Boundaries &amp; Mass Convergence</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-14"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../numerics/telemac/boundaries.html">Boundary Conditions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../numerics/telemac/convergence.html">Convergence (Quantitative)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../numerics/telemac/mass-optimization.html">Mass Conservation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../numerics/telemac/roughness.html">Friction (Roughness) Zones</a></li>




<li class="toctree-l2"><a class="reference internal" href="../numerics/telemac/optimization.html">Optimization</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../numerics/openfoam/of-intro.html">OpenFOAM</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-15"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../numerics/openfoam/of-tutorial-multiphase.html">Multiphase Solver (interFoam Tutorial)</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-16"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../numerics/openfoam/of-tutorial-multiphase-mesh.html">Geometry and Mesh Generation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../numerics/openfoam/of-tutorial-multiphase-setup.html">Case set-up</a></li>




<li class="toctree-l3"><a class="reference internal" href="../numerics/openfoam/of-tutorial-multiphase-run.html">Run OpenFOAM</a></li>
<li class="toctree-l3"><a class="reference internal" href="../numerics/openfoam/of-tutorial-multiphase-post.html">Post-processing</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Machine Learning (ML)</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../datascience/machinelearning.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../datascience/dimensional-analysis.html">About Data Analysis</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../datascience/supervised-learning.html">Supervised Learning</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-17"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../datascience/linear-models.html">Linear Models</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-18"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../datascience/linear-classification.html">Linear Classification</a></li>
<li class="toctree-l3"><a class="reference internal" href="../datascience/linear-regression.html">Linear Regression</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../datascience/non-linear-models.html">Non-linear models</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-19"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../datascience/kernelized-supervised-models.html">Kernels</a></li>
<li class="toctree-l3"><a class="reference internal" href="../datascience/morphology-predictor-svm.html">Support Vector Machine (SVM)</a></li>


<li class="toctree-l3"><a class="reference internal" href="../datascience/three-based-methods.html">Three-based methods (Coming soon)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../datascience/neural-networks.html">Neural Networks (Supervised)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../datascience/unsupervised-learning.html">Unsupervised Learning (Coming soon)</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Documentation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../documentation/how-to-document.html">How to Markdown and Document</a></li>
<li class="toctree-l1"><a class="reference internal" href="../documentation/glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../documentation/notation.html">Notation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../documentation/bibliography.html">References</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../exercises/docs-exercises.html">Exercises</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-20"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../exercises/ex-git.html">Git and Markdown</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Troubleshoot</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../troubleshoot/dbg-programming.html">Programming Tools and IDEs</a><input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-21"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../troubleshoot/dbg-anaconda.html">Debugging Anaconda</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshoot/dbg-python.html">Debugging Python Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshoot/dbg-jupyter.html">Debugging Jupyter</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../troubleshoot/dbg-numerical-models.html">Numerical Models</a><input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-22"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../troubleshoot/dbg-basement.html">Debugging BASEMENT</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshoot/dbg-telemac.html">Debugging TELEMAC</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../troubleshoot/dbg-os.html">Operating Systems (Linux and VMs)</a><input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-23"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../troubleshoot/dbg-linux.html">Debugging Debian Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshoot/dbg-vm.html">Debugging Virtual Machines</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../troubleshoot/dbg-scilife.html">Science Life Hacks</a><input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-24"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../troubleshoot/dbg-gis.html">GIS, CRS and Projections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshoot/dbg-zotero.html">Zotero Utilities</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">About</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../terms/license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../terms/disclaimer.html">Disclaimer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../documentation/contributors.html">Contributors</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/hydro-informatics/jupyter-python-course/main/v2/gh/hydro-informatics/jupyter-python-course/main?urlpath=lab/tree/jupyter/geo-shp.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/hydro-informatics/jupyter-python-course/blob/main/jupyter/geo-shp.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>



<a href="https://github.com/hydro-informatics/jupyter-python-course" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/jupyter/geo-shp.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Shapefile (Vector) Handling</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#load-an-existing-shapefile">Load an Existing Shapefile</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-a-new-shapefile">Create a New Shapefile</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#get-and-set-shapefile-projections">Get and Set Shapefile Projections</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#transform-re-project-a-shapefile">Transform (Re-project) a Shapefile</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#add-fields-and-point-features-to-a-shapefile">Add Fields and Point Features to a Shapefile</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multiline-polyline-shapefile">Multiline (Polyline) Shapefile</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#polygon-shapefile">Polygon Shapefile</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#build-shapefile-from-json">Build Shapefile from JSON</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculate-geometric-attributes">Calculate Geometric Attributes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#export-to-other-formats">Export to Other Formats</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#geojson">GeoJSON</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kml-google-earth">KML (Google Earth)</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="shapefile-vector-handling">
<span id="chpt-shp"></span><h1>Shapefile (Vector) Handling<a class="headerlink" href="#shapefile-vector-handling" title="Permalink to this headline">#</a></h1>
<p>This section introduces geospatial analysis of shapefiles with gdal, ogr, and osr. For interactive reading and executing code blocks <a class="reference external" href="https://mybinder.org/v2/gh/hydro-informatics/jupyter-python-course/main?filepath=jupyter"><img alt="Binder" src="https://mybinder.org/badge_logo.svg" /></a> and find <em>geo01-shp.ipynb</em>, or install <a class="reference internal" href="../python-basics/pyinstall.html#install-python"><span class="std std-ref">Python</span></a> and <a class="reference internal" href="../get-started/ide.html#jupyter"><span class="std std-ref">JupyterLab</span></a> locally.</p>
<div class="admonition-requirements admonition">
<p class="admonition-title">Requirements</p>
<ul class="simple">
<li><p>Make sure to understand <a class="reference internal" href="../geopy/geospatial-data.html#shp"><span class="std std-ref">shapefiles</span></a> and <a class="reference internal" href="../geopy/geospatial-data.html#vector"><span class="std std-ref">vector data</span></a></p></li>
<li><p>Accomplish the <a class="reference internal" href="../geopy/use-qgis.html#qgis-tutorial"><span class="std std-ref">QGIS tutorial</span></a></p></li>
</ul>
</div>
<div class="tip admonition">
<p class="admonition-title">Use flusstools</p>
<p>The core functions featured in this section are also implemented in <a class="reference external" href="https://flusstools.readthedocs.io">flusstools</a>. To use those functions, make sure flusstools is installed and import it as follows: <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">flusstools</span> <span class="pre">import</span> <span class="pre">geotools</span></code>. Some of the functions shown in this tutorial can then be used with <code class="docutils literal notranslate"><span class="pre">geotools.function_name()</span></code>.</p>
</div>
<div class="tip dropdown admonition">
<p class="admonition-title">Watch this section and the Python tutorials in video formats</p>
<iframe width="701" height="394" src="https://www.youtube-nocookie.com/embed/HK1bRdM8nR4" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<p>Watch this section as a video on the <a href="https://www.youtube.com/@hydroinformatics">@Hydro-Morphodynamics channel on YouTube</a>.</p>
</div>
<section id="load-an-existing-shapefile">
<h2>Load an Existing Shapefile<a class="headerlink" href="#load-an-existing-shapefile" title="Permalink to this headline">#</a></h2>
<p>OSGeo’s <code class="docutils literal notranslate"><span class="pre">ogr</span></code> module is an excellent source for handling shapefiles. After importing the libraries, the correct driver for handling shapefiles (<code class="docutils literal notranslate"><span class="pre">&quot;ESRI</span> <span class="pre">Shapefile&quot;</span></code>) with Python needs to be called. Next, with the driver object (<code class="docutils literal notranslate"><span class="pre">ogr.GetDriverByName(&quot;SHAPEFILE&quot;)</span></code>), we can open (instantiate) a shapefile (object with <code class="docutils literal notranslate"><span class="pre">shp_driver.Open(&quot;SHAPEFILE&quot;)</span></code>), which contains layer information. It is precisely the layer information (i.e., references to shapefile attributes) that we want to work with. Therefore we have to instantiate a shapefile layer object with <code class="docutils literal notranslate"><span class="pre">shp_dataset.GetLayer()</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">ogr</span>
<span class="n">shp_driver</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">GetDriverByName</span><span class="p">(</span><span class="s2">&quot;ESRI Shapefile&quot;</span><span class="p">)</span>
<span class="n">shp_dataset</span> <span class="o">=</span> <span class="n">shp_driver</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="s2">&quot;geodata/shapefiles/cities.shp&quot;</span><span class="p">)</span>
<span class="n">shp_layer</span> <span class="o">=</span> <span class="n">shp_dataset</span><span class="o">.</span><span class="n">GetLayer</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>To get a full list of supported <code class="docutils literal notranslate"><span class="pre">ogr</span></code> drivers (e.g., for <code class="docutils literal notranslate"><span class="pre">DXF</span></code>, <code class="docutils literal notranslate"><span class="pre">ESRIJSON</span></code>, <code class="docutils literal notranslate"><span class="pre">GPS</span></code>, <code class="docutils literal notranslate"><span class="pre">PDF</span></code>, <code class="docutils literal notranslate"><span class="pre">SQLite</span></code>, <code class="docutils literal notranslate"><span class="pre">XLSX</span></code>, and many more), <a class="reference external" href="https://raw.githubusercontent.com/hydro-informatics/material-py-codes/main/geo/get_ogr_drivers.py">download the script <code class="docutils literal notranslate"><span class="pre">get_ogr_drivers.py</span></code></a> from hydro-informatics on Github.</p>
</div>
<div class="important admonition">
<p class="admonition-title">Do not use <strong>from gdal import ogr</strong></p>
<p>Importing <code class="docutils literal notranslate"><span class="pre">ogr</span></code> with <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">gdal</span> <span class="pre">import</span> <span class="pre">ogr</span></code> is deprecated since GDAL v3. Therefore, <code class="docutils literal notranslate"><span class="pre">ogr</span></code> must be imported from <code class="docutils literal notranslate"><span class="pre">osgeo</span></code>.</p>
</div>
</section>
<section id="create-a-new-shapefile">
<span id="create-shp"></span><h2>Create a New Shapefile<a class="headerlink" href="#create-a-new-shapefile" title="Permalink to this headline">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">ogr</span></code> also enables creating a new point, line, or polygon shapefile. The following code block defines a function for creating a shapefile, where the optional keyword argument <code class="docutils literal notranslate"><span class="pre">overwrite</span></code> is used to control whether an existing shapefile with the same name should be overwritten (default: <code class="docutils literal notranslate"><span class="pre">True</span></code>).
The command <code class="docutils literal notranslate"><span class="pre">shp_driver.CreateDataSource(SHP-FILE-DIR)</span></code> creates a new shapefile and the rest of the function adds a layer to the shapefile if the optional keyword arguments <code class="docutils literal notranslate"><span class="pre">layer_name</span></code> and <code class="docutils literal notranslate"><span class="pre">layer_type</span></code> are provided. Both optional keywords must be <em>string</em>s, where <code class="docutils literal notranslate"><span class="pre">layer_name</span></code> can be any name for the new layer. <code class="docutils literal notranslate"><span class="pre">layer_type</span></code> must be either <code class="docutils literal notranslate"><span class="pre">&quot;point&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;line&quot;</span></code>, or <code class="docutils literal notranslate"><span class="pre">&quot;polygon&quot;</span></code> to create a point, (poly)line, or polygon shapefile, respectively. The function uses the <code class="docutils literal notranslate"><span class="pre">geometry_dict</span></code> <em>dictionary</em> to assign the correct <code class="docutils literal notranslate"><span class="pre">ogr.SHP-TYPE</span></code> to the layer. There are more options for extending the <code class="docutils literal notranslate"><span class="pre">create_shp(...)</span></code> function listed on <a class="reference external" href="https://pcjericks.github.io/py-gdalogr-cookbook/geometry.html"><em>pcjerick</em>’s Github pages</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">ogr</span>
<span class="kn">import</span> <span class="nn">os</span>


<span class="k">def</span> <span class="nf">create_shp</span><span class="p">(</span><span class="n">shp_file_dir</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param shp_file_dir: STR of the (relative shapefile directory (ends on &quot;.shp&quot;)</span>
<span class="sd">    :param overwrite: [optional] BOOL - if True, existing files are overwritten</span>
<span class="sd">    :kwarg layer_name: [optional] STR of the layer_name - if None: no layer will be created (max. 13 chars)</span>
<span class="sd">    :kwarg layer_type: [optional] STR (&quot;point, &quot;line&quot;, or &quot;polygon&quot;) of the layer_name - if None: no layer will be created</span>
<span class="sd">    :output: returns an ogr shapefile layer</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">shp_driver</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">GetDriverByName</span><span class="p">(</span><span class="s2">&quot;ESRI Shapefile&quot;</span><span class="p">)</span>

    <span class="c1"># check if output file exists if yes delete it</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">shp_file_dir</span><span class="p">)</span> <span class="ow">and</span> <span class="n">overwrite</span><span class="p">:</span>
        <span class="n">shp_driver</span><span class="o">.</span><span class="n">DeleteDataSource</span><span class="p">(</span><span class="n">shp_file_dir</span><span class="p">)</span>

    <span class="c1"># create and return new shapefile object</span>
    <span class="n">new_shp</span> <span class="o">=</span> <span class="n">shp_driver</span><span class="o">.</span><span class="n">CreateDataSource</span><span class="p">(</span><span class="n">shp_file_dir</span><span class="p">)</span>

    <span class="c1"># create layer if layer_name and layer_type are provided</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;layer_name&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;layer_type&quot;</span><span class="p">):</span>
        <span class="c1"># create dictionary of ogr.SHP-TYPES</span>
        <span class="n">geometry_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;point&quot;</span><span class="p">:</span> <span class="n">ogr</span><span class="o">.</span><span class="n">wkbPoint</span><span class="p">,</span>
                         <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="n">ogr</span><span class="o">.</span><span class="n">wkbMultiLineString</span><span class="p">,</span>
                         <span class="s2">&quot;polygon&quot;</span><span class="p">:</span> <span class="n">ogr</span><span class="o">.</span><span class="n">wkbMultiPolygon</span><span class="p">}</span>
        <span class="c1"># create layer</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">new_shp</span><span class="o">.</span><span class="n">CreateLayer</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;layer_name&quot;</span><span class="p">)),</span>
                                <span class="n">geom_type</span><span class="o">=</span><span class="n">geometry_dict</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;layer_type&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">())])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: Invalid layer_type provided (must be &#39;point&#39;, &#39;line&#39;, or &#39;polygon&#39;).&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: layer_name and layer_type must be string.&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: Cannot access layer - opened in other program?&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_shp</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">create_shp</span></code> function is also provided with <a class="reference external" href="https://flusstools.readthedocs.io">flusstools</a> (<a class="reference external" href="https://flusstools.readthedocs.io/en/latest/geotools.html#module-flusstools.geotools.shp_mgmt"><code class="docutils literal notranslate"><span class="pre">flusstools.geotools.create_shp()</span></code></a>) and aids to create a new shapefile (make sure to get the directory right):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a_new_shp_file</span> <span class="o">=</span> <span class="n">create_shp</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;/geodata/shapefiles/new_polygons.shp&quot;</span><span class="p">,</span> <span class="n">layer_name</span><span class="o">=</span><span class="s2">&quot;basemap&quot;</span><span class="p">,</span> <span class="n">layer_type</span><span class="o">=</span><span class="s2">&quot;polygon&quot;</span><span class="p">)</span>

<span class="c1"># release data source</span>
<span class="n">a_new_shape_file</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>A <strong>shapefile name</strong> may <strong>not</strong> have <strong>more than 13 characters</strong> and a <strong>field name</strong> may <strong>not</strong> have <strong>more than 10 characters</strong> (read more in <a class="reference external" href="http://resources.arcgis.com/en/help/main/10.1/index.html#//005600000013000000">Esri’s shapefile docs</a>).</p>
</div>
<p>Shapefiles can also be created and drawn in QGIS and the following figures guide through the procedure of creating a polygon shapefile. We will not need the resulting shapefile in this section anymore, but later for making it interact with raster datasets.</p>
<p>The first step to making a shapefile with QGIS is obviously to run QGIS and create a new project. The following example uses water depth and flow velocity raster data as background information to delineate the so-called <a class="reference external" href="https://www.sciencedirect.com/science/article/pii/S0169555X14000099"><em>morphological unit</em> of <em>slackwater</em></a>. Both the water depth and flow velocity rasters are part of the <a class="reference external" href="https://github.com/RiverArchitect/SampleData/archive/master.zip"><em>River Architect</em> sample datasets</a> (precisely located at <a class="reference external" href="https://github.com/RiverArchitect/SampleData/tree/master/01_Conditions/2100_sample"><code class="docutils literal notranslate"><span class="pre">RiverArchitect/SampleData/01_Conditions/2100_sample/</span></code></a>). After downloading the sample data, they can be imported in QGIS by dragging the files from the <strong>Browser</strong> panel into the <em>Layers</em> panel. Then:</p>
<figure class="align-default" id="qgis-create-shp-py">
<img alt="qgis create new shapefile" src="../_images/qgis-create-shp.png" />
<figcaption>
<p><span class="caption-number">Fig. 40 </span><span class="caption-text">QGIS: Create Layer &gt; New Shapefile Layer…</span><a class="headerlink" href="#qgis-create-shp-py" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-default" id="qgis-new-shp-py">
<img alt="qgis define new shapefile" src="../_images/qgis-new-shp.png" />
<figcaption>
<p><span class="caption-number">Fig. 41 </span><span class="caption-text">Define New Shapefile Layer</span><a class="headerlink" href="#qgis-new-shp-py" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-default" id="qgis-toggle-editing-py">
<img alt="qgis shapefile toggle-editing" src="../_images/qgis-toggle-editing.png" />
<figcaption>
<p><span class="caption-number">Fig. 42 </span><span class="caption-text">Enable shapefile editing</span><a class="headerlink" href="#qgis-toggle-editing-py" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-default" id="qgis-draw-polygon-py">
<img alt="qgis draw polygon shapefile" src="../_images/qgis-draw-polygon.png" />
<figcaption>
<p><span class="caption-number">Fig. 43 </span><span class="caption-text">Draw polygons in a shapefile in QGIS.</span><a class="headerlink" href="#qgis-draw-polygon-py" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="get-and-set-shapefile-projections">
<span id="prj-shp"></span><h2>Get and Set Shapefile Projections<a class="headerlink" href="#get-and-set-shapefile-projections" title="Permalink to this headline">#</a></h2>
<p>The terminology used in the <code class="docutils literal notranslate"><span class="pre">.prj</span></code> files of a shapefile corresponds to the definitions in the <a class="reference internal" href="../geopy/geospatial-data.html#prj"><span class="std std-ref">geospatial data</span></a> section. In Python, information about the coordinate system is available through <code class="docutils literal notranslate"><span class="pre">shp_layer.GetSpatialRef()</span></code> of the <code class="docutils literal notranslate"><span class="pre">ogr</span></code> library:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">shp_srs</span> <span class="o">=</span> <span class="n">shp_layer</span><span class="o">.</span><span class="n">GetSpatialRef</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">shp_srs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GEOGCS[&quot;WGS 84&quot;,
    DATUM[&quot;WGS_1984&quot;,
        SPHEROID[&quot;WGS 84&quot;,6378137,298.257223563,
            AUTHORITY[&quot;EPSG&quot;,&quot;7030&quot;]],
        AUTHORITY[&quot;EPSG&quot;,&quot;6326&quot;]],
    PRIMEM[&quot;Greenwich&quot;,0,
        AUTHORITY[&quot;EPSG&quot;,&quot;8901&quot;]],
    UNIT[&quot;degree&quot;,0.0174532925199433,
        AUTHORITY[&quot;EPSG&quot;,&quot;9122&quot;]],
    AXIS[&quot;Latitude&quot;,NORTH],
    AXIS[&quot;Longitude&quot;,EAST],
    AUTHORITY[&quot;EPSG&quot;,&quot;4326&quot;]]
</pre></div>
</div>
</div>
</div>
<p>This <code class="docutils literal notranslate"><span class="pre">GEOGCS</span></code> definition of the above shapefile corresponds to Esri’s <em>well-known</em> text (WKT). Since the shapefile format was developed by Esri, Esri’s WKT (<strong>esriwkt</strong>) format must be used in <code class="docutils literal notranslate"><span class="pre">.prj</span></code> files. The <em>Open Geospatial Consortium</em> (<em>OGC</em>) uses a different well-known text in their <code class="docutils literal notranslate"><span class="pre">EPSG:XXXX</span></code> definitions (e.g., available at <a class="reference external" href="http://www.spatialreference.org">spatialreference.org</a>).</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">GEOGCS</span><span class="o">[</span><span class="s">&quot;WGS 84&quot;</span><span class="p">,</span>
<span class="w">       </span><span class="n">DATUM</span><span class="o">[</span><span class="s">&quot;WGS_1984&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">SPHEROID</span><span class="o">[</span><span class="s">&quot;WGS84&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">6378137</span><span class="p">,</span><span class="w"> </span><span class="mf">298.257223563</span><span class="p">,</span><span class="w"> </span><span class="n">AUTHORITY</span><span class="o">[</span><span class="s">&quot;EPSG&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;7030&quot;</span><span class="o">]]</span><span class="p">,</span><span class="w"> </span><span class="n">AUTHORITY</span><span class="o">[</span><span class="s">&quot;EPSG&quot;</span><span class="p">,</span><span class="s">&quot;6326&quot;</span><span class="o">]]</span><span class="p">,</span>
<span class="w">       </span><span class="n">PRIMEM</span><span class="o">[</span><span class="s">&quot;Greenwich&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">AUTHORITY</span><span class="o">[</span><span class="s">&quot;EPSG&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;8901&quot;</span><span class="o">]]</span><span class="p">,</span>
<span class="w">       </span><span class="n">UNIT</span><span class="o">[</span><span class="s">&quot;degree&quot;</span><span class="p">,</span><span class="mf">0.01745329251994328</span><span class="p">,</span><span class="w"> </span><span class="n">AUTHORITY</span><span class="o">[</span><span class="s">&quot;EPSG&quot;</span><span class="p">,</span><span class="s">&quot;9122&quot;</span><span class="o">]]</span><span class="p">,</span><span class="n">AUTHORITY</span><span class="o">[</span><span class="s">&quot;EPSG&quot;</span><span class="p">,</span><span class="s">&quot;4326&quot;</span><span class="o">]]</span>
</pre></div>
</div>
<p>To redefine or newly define the coordinate system of a shapefile, we can use <a class="reference external" href="http://www.spatialreference.org">spatialreference.org</a> through Python’s default <code class="docutils literal notranslate"><span class="pre">urllib</span></code> library.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Running the following code block requires an internet connection.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">urllib</span>

<span class="c1"># function to get spatialreferences with epsg code</span>
<span class="k">def</span> <span class="nf">get_esriwkt</span><span class="p">(</span><span class="n">epsg</span><span class="p">):</span>    
    <span class="c1"># usage get_epsg_code(4326)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="s2">&quot;http://spatialreference.org/ref/epsg/</span><span class="si">{0}</span><span class="s2">/esriwkt/&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">epsg</span><span class="p">))</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">())</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="s2">&quot;http://spatialreference.org/ref/sr-org/epsg</span><span class="si">{0}</span><span class="s2">-wgs84-web-mercator-auxiliary-sphere/esriwkt/&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">epsg</span><span class="p">))</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">())</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
        <span class="c1"># sr-org codes are available at &quot;https://spatialreference.org/ref/sr-org/{0}/esriwkt/&quot;.format(epsg)</span>
        <span class="c1"># for example EPSG:3857 = SR-ORG:6864 -&gt; https://spatialreference.org/ref/sr-org/6864/esriwkt/ = EPSG:3857</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: Could not find epsg code on spatialreference.org. Returning default WKT(epsg=4326).&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;GEOGCS[&quot;GCS_WGS_1984&quot;,DATUM[&quot;D_WGS_1984&quot;,SPHEROID[&quot;WGS_1984&quot;,6378137,298.257223563]],PRIMEM[&quot;Greenwich&quot;,0],UNIT[&quot;Degree&quot;,0.017453292519943295],UNIT[&quot;Meter&quot;,1]]&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>This function can be used to create a new projection file:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># open the hypy-area shapefile</span>
<span class="n">shp_file</span> <span class="o">=</span> <span class="s2">&quot;hypy-area&quot;</span>

<span class="c1"># create new .prj file for the shapefile (.shp and .prj must have the same name)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;geodata/shapefiles/</span><span class="si">{0}</span><span class="s2">.prj&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">shp_file</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">prj</span><span class="p">:</span>
    <span class="n">epsg_code</span> <span class="o">=</span> <span class="n">get_esriwkt</span><span class="p">(</span><span class="mi">4326</span><span class="p">)</span>
    <span class="n">prj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">epsg_code</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Wrote projection file : &quot;</span> <span class="o">+</span> <span class="n">epsg_code</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Wrote projection file : GEOGCS[&quot;GCS_WGS_1984&quot;,DATUM[&quot;D_WGS_1984&quot;,SPHEROID[&quot;WGS_1984&quot;,6378137,298.257223563]],PRIMEM[&quot;Greenwich&quot;,0],UNIT[&quot;Degree&quot;,0.017453292519943295]]
</pre></div>
</div>
</div>
</div>
<p>An offline alternative for generating a <code class="docutils literal notranslate"><span class="pre">.prj</span></code> file is the <code class="docutils literal notranslate"><span class="pre">osr</span></code> library that comes along with <code class="docutils literal notranslate"><span class="pre">gdal</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">osr</span>

<span class="k">def</span> <span class="nf">get_wkt</span><span class="p">(</span><span class="n">epsg</span><span class="p">,</span> <span class="n">wkt_format</span><span class="o">=</span><span class="s2">&quot;esriwkt&quot;</span><span class="p">):</span>
    <span class="n">default</span> <span class="o">=</span> <span class="s1">&#39;GEOGCS[&quot;GCS_WGS_1984&quot;,DATUM[&quot;D_WGS_1984&quot;,SPHEROID[&quot;WGS_1984&quot;,6378137,298.257223563]],PRIMEM[&quot;Greenwich&quot;,0],UNIT[&quot;Degree&quot;,0.017453292519943295],UNIT[&quot;Meter&quot;,1]]&#39;</span>
    <span class="n">spatial_ref</span> <span class="o">=</span> <span class="n">osr</span><span class="o">.</span><span class="n">SpatialReference</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">spatial_ref</span><span class="o">.</span><span class="n">ImportFromEPSG</span><span class="p">(</span><span class="n">epsg</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: epsg must be integer. Returning default WKT(epsg=4326).&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">default</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: epsg number does not exist. Returning default WKT(epsg=4326).&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">default</span>
    <span class="k">if</span> <span class="n">wkt_format</span><span class="o">==</span><span class="s2">&quot;esriwkt&quot;</span><span class="p">:</span>
        <span class="n">spatial_ref</span><span class="o">.</span><span class="n">MorphToESRI</span><span class="p">()</span>
    <span class="c1"># return a nicely formatted WKT string (alternatives: ExportToPCI(), ExportToUSGS(), or ExportToXML())</span>
    <span class="k">return</span> <span class="n">spatial_ref</span><span class="o">.</span><span class="n">ExportToPrettyWkt</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="transform-re-project-a-shapefile">
<span id="reproject-shp"></span><h2>Transform (Re-project) a Shapefile<a class="headerlink" href="#transform-re-project-a-shapefile" title="Permalink to this headline">#</a></h2>
<p>A re-projection may be needed, for instance, to use a shapefile in <code class="docutils literal notranslate"><span class="pre">EPSG:4326</span></code> (e.g., created with QGIS) in a web-GIS application (e.g., open street maps) that typically uses <code class="docutils literal notranslate"><span class="pre">EPSG:3857</span></code>. To apply a different projection to geometric objects of a shapefile, it is not enough to simply rewrite the <code class="docutils literal notranslate"><span class="pre">.prj</span></code> file. Therefore, the following example shows the re-projection of the <code class="docutils literal notranslate"><span class="pre">countries.shp</span></code> shapefile from the <a class="reference external" href="http://naciscdn.org/naturalearth/packages/Natural_Earth_quick_start.zip">Natural Earth quick start kit</a>. The following workflow performs the reprojection:</p>
<ul class="simple">
<li><p>Save shapefile to transform is located in the subdirectory <code class="docutils literal notranslate"><span class="pre">geodata/shapefiles/countries.shp</span></code> and open it in the Python script as described above.</p></li>
<li><p>Read and identify the spatial reference system used in the input shapefile:</p>
<ul>
<li><p>Create a spatial reference object with <code class="docutils literal notranslate"><span class="pre">in_sr</span> <span class="pre">=</span> <span class="pre">osr.SpatialReference(str(shapefile.GetSpatialRef()))</span></code>.</p></li>
<li><p>Detect the spatial reference system in EPSG format with <code class="docutils literal notranslate"><span class="pre">AutoIdentifyEPSG()</span></code>.</p></li>
<li><p>Assign the EPSG-formatted spatial reference system to the spatial reference object of the input shapefile (<code class="docutils literal notranslate"><span class="pre">ImportFromEPSG(int(in_sr.GetAuthorityCode(None)))</span></code>).</p></li>
</ul>
</li>
<li><p>Create the output spatial reference with <code class="docutils literal notranslate"><span class="pre">out_sr</span> <span class="pre">=</span> <span class="pre">osr.SpatialReference()</span></code> and apply the target EPSG code (<code class="docutils literal notranslate"><span class="pre">out_sr.ImportFromEPSG(3857)</span></code>).</p></li>
<li><p>Create a coordinate transformation object (<code class="docutils literal notranslate"><span class="pre">coord_trans</span> <span class="pre">=</span> <span class="pre">osr.CoordinateTransformation(in_sr,</span> <span class="pre">out_sr)</span></code>) that enables re-projecting geometry objects later.</p></li>
<li><p>Create the output shapefile, which will correspond to a copy of the input shapefile (use the above-defined <code class="docutils literal notranslate"><span class="pre">create_shp</span></code> function with <code class="docutils literal notranslate"><span class="pre">layer_name=&quot;basemap&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">layer_type=&quot;line&quot;</span></code>).</p></li>
<li><p>Copy the field names and types of the input shapefile:</p>
<ul>
<li><p>Read the attribute layer from the input file’s layer definitions with <code class="docutils literal notranslate"><span class="pre">in_lyr_def</span> <span class="pre">=</span> <span class="pre">in_shp_lyr.GetLayerDefn()</span></code></p></li>
<li><p>Iterate through the field definitions and append them to the output shapefile layer (<code class="docutils literal notranslate"><span class="pre">out_shp_lyr</span></code>)</p></li>
</ul>
</li>
<li><p>Iterate through the geometry features in the input shapefile:</p>
<ul>
<li><p>Use the new (output) shapefile’s layer definitions (<code class="docutils literal notranslate"><span class="pre">out_shp_lyr_def</span> <span class="pre">=</span> <span class="pre">out_shp_lyr.GetLayerDefn()</span></code>) to append transformed geometry objects later.</p></li>
<li><p>Define an iteration variable <code class="docutils literal notranslate"><span class="pre">in_feature</span></code> as an instance of <code class="docutils literal notranslate"><span class="pre">in_shp_lyr.GetNextFeature</span></code>.</p></li>
<li><p>In a <code class="docutils literal notranslate"><span class="pre">while</span></code> loop, instantiate every geometry (<code class="docutils literal notranslate"><span class="pre">geometry</span> <span class="pre">=</span> <span class="pre">in_feature.GetGeometryRef()</span></code>) in the input shapefile, transform the <code class="docutils literal notranslate"><span class="pre">geometry</span></code> (<code class="docutils literal notranslate"><span class="pre">geometry.Transform(coord_trans)</span></code>), convert it to an <code class="docutils literal notranslate"><span class="pre">ogr.Feature()</span></code> with the <code class="docutils literal notranslate"><span class="pre">SetGeometry(geometry)</span></code> method, copy field definitions (nested <code class="docutils literal notranslate"><span class="pre">for</span></code>-loop), and append the new feature to the output shapefile layer (<code class="docutils literal notranslate"><span class="pre">out_shp_lyr_def.CreateFeature(out_feature)</span></code>).</p></li>
<li><p>At the end of the <code class="docutils literal notranslate"><span class="pre">while</span></code>-loop, look for the next feature in the input shapefile’s attributes with <code class="docutils literal notranslate"><span class="pre">in_feature</span> <span class="pre">=</span> <span class="pre">in_shp_lyr.GetNextFeature()</span></code></p></li>
</ul>
</li>
<li><p>Unlock (release) all layers and shapefiles by overwriting the objects with <code class="docutils literal notranslate"><span class="pre">None</span></code> (nothing is written to any file as long as these variables exist!).</p></li>
<li><p>Assign the new projection EPSG:3857 using the above-defined <code class="docutils literal notranslate"><span class="pre">get_wkt</span></code> function.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">ogr</span>
<span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">osr</span>

<span class="n">shp_driver</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">GetDriverByName</span><span class="p">(</span><span class="s2">&quot;ESRI Shapefile&quot;</span><span class="p">)</span>

<span class="c1"># open input shapefile and layer</span>
<span class="n">in_shp</span> <span class="o">=</span> <span class="n">shp_driver</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/geodata/shapefiles/countries.shp&quot;</span><span class="p">)</span>
<span class="n">in_shp_lyr</span> <span class="o">=</span> <span class="n">in_shp</span><span class="o">.</span><span class="n">GetLayer</span><span class="p">()</span>

<span class="c1"># get input SpatialReference</span>
<span class="n">in_sr</span> <span class="o">=</span> <span class="n">osr</span><span class="o">.</span><span class="n">SpatialReference</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">in_shp_lyr</span><span class="o">.</span><span class="n">GetSpatialRef</span><span class="p">()))</span>
<span class="c1"># auto-detect epsg</span>
<span class="n">in_sr</span><span class="o">.</span><span class="n">AutoIdentifyEPSG</span><span class="p">()</span>
<span class="c1"># assign input SpatialReference</span>
<span class="n">in_sr</span><span class="o">.</span><span class="n">ImportFromEPSG</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">in_sr</span><span class="o">.</span><span class="n">GetAuthorityCode</span><span class="p">(</span><span class="kc">None</span><span class="p">)))</span>

<span class="c1"># create SpatialReference for new shapefile</span>
<span class="n">out_sr</span> <span class="o">=</span> <span class="n">osr</span><span class="o">.</span><span class="n">SpatialReference</span><span class="p">()</span>
<span class="n">out_sr</span><span class="o">.</span><span class="n">ImportFromEPSG</span><span class="p">(</span><span class="mi">3857</span><span class="p">)</span>

<span class="c1"># create a CoordinateTransformation object</span>
<span class="n">coord_trans</span> <span class="o">=</span> <span class="n">osr</span><span class="o">.</span><span class="n">CoordinateTransformation</span><span class="p">(</span><span class="n">in_sr</span><span class="p">,</span> <span class="n">out_sr</span><span class="p">)</span>

<span class="c1"># create output shapefile and get layer</span>
<span class="n">out_shp</span> <span class="o">=</span> <span class="n">create_shp</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/geodata/shapefiles/countries-web.shp&quot;</span><span class="p">,</span> <span class="n">layer_name</span><span class="o">=</span><span class="s2">&quot;basemap&quot;</span><span class="p">,</span> <span class="n">layer_type</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">)</span>
<span class="n">out_shp_lyr</span> <span class="o">=</span> <span class="n">out_shp</span><span class="o">.</span><span class="n">GetLayer</span><span class="p">()</span>

<span class="c1"># look up layer (features) definitions in input shapefile</span>
<span class="n">in_lyr_def</span> <span class="o">=</span> <span class="n">in_shp_lyr</span><span class="o">.</span><span class="n">GetLayerDefn</span><span class="p">()</span>
<span class="c1"># copy field names of input layer attribute table to output layer</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">in_lyr_def</span><span class="o">.</span><span class="n">GetFieldCount</span><span class="p">()):</span>
    <span class="n">out_shp_lyr</span><span class="o">.</span><span class="n">CreateField</span><span class="p">(</span><span class="n">in_lyr_def</span><span class="o">.</span><span class="n">GetFieldDefn</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

<span class="c1"># instantiate feature definitions object for output layer (currently empty)</span>
<span class="n">out_shp_lyr_def</span> <span class="o">=</span> <span class="n">out_shp_lyr</span><span class="o">.</span><span class="n">GetLayerDefn</span><span class="p">()</span>

<span class="c1"># iteratively append all input features in new projection</span>
<span class="n">in_feature</span> <span class="o">=</span> <span class="n">in_shp_lyr</span><span class="o">.</span><span class="n">GetNextFeature</span><span class="p">()</span>
<span class="k">while</span> <span class="n">in_feature</span><span class="p">:</span>
    <span class="c1"># get the input geometry</span>
    <span class="n">geometry</span> <span class="o">=</span> <span class="n">in_feature</span><span class="o">.</span><span class="n">GetGeometryRef</span><span class="p">()</span>
    <span class="c1"># re-project (transform) geometry to new system</span>
    <span class="n">geometry</span><span class="o">.</span><span class="n">Transform</span><span class="p">(</span><span class="n">coord_trans</span><span class="p">)</span>
    <span class="c1"># create new output feature</span>
    <span class="n">out_feature</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">Feature</span><span class="p">(</span><span class="n">out_shp_lyr_def</span><span class="p">)</span>
    <span class="c1"># assign in-geometry to output feature and copy field values</span>
    <span class="n">out_feature</span><span class="o">.</span><span class="n">SetGeometry</span><span class="p">(</span><span class="n">geometry</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">out_shp_lyr_def</span><span class="o">.</span><span class="n">GetFieldCount</span><span class="p">()):</span>
        <span class="n">out_feature</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="n">out_shp_lyr_def</span><span class="o">.</span><span class="n">GetFieldDefn</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">GetNameRef</span><span class="p">(),</span> <span class="n">in_feature</span><span class="o">.</span><span class="n">GetField</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
    <span class="c1"># add the feature to the shapefile</span>
    <span class="n">out_shp_lyr</span><span class="o">.</span><span class="n">CreateFeature</span><span class="p">(</span><span class="n">out_feature</span><span class="p">)</span>
    <span class="c1"># prepare next iteration</span>
    <span class="n">in_feature</span> <span class="o">=</span> <span class="n">in_shp_lyr</span><span class="o">.</span><span class="n">GetNextFeature</span><span class="p">()</span>

<span class="c1"># release shapefiles and layers</span>
<span class="n">in_shp</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">in_shp_lyr</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">out_shp</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">out_shp_lyr</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># create .prj file for  output shapefile for web application references</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/geodata/shapefiles/countries-web.prj&quot;</span><span class="p">,</span> <span class="s2">&quot;w+&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">prj</span><span class="p">:</span>
    <span class="n">prj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">get_wkt</span><span class="p">(</span><span class="mi">3857</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition-challenge admonition">
<p class="admonition-title">Challenge</p>
<p>Re-write the above code block in a <code class="docutils literal notranslate"><span class="pre">re_project(shp_file,</span> <span class="pre">target_epsg)</span></code> function.</p>
</div>
<p>In the case of success, the code sequence <code class="docutils literal notranslate"><span class="pre">in_sr.AutoIdentifyEPSG()</span></code> returns <code class="docutils literal notranslate"><span class="pre">0</span></code> (i.e., it successfully recognized the <code class="docutils literal notranslate"><span class="pre">EPSG</span></code> number), but unfortunately, many EPSG numbers are not known to <code class="docutils literal notranslate"><span class="pre">AutoIdentifyEPSG()</span></code>. In the case that <code class="docutils literal notranslate"><span class="pre">AutoIdentifyEPSG()</span></code> did not function propperly, the method does not return <code class="docutils literal notranslate"><span class="pre">0</span></code>, but <code class="docutils literal notranslate"><span class="pre">7</span></code>, for example. A workaround for the limited functionality of <code class="docutils literal notranslate"><span class="pre">srs.AutoIdentifyEPSG()</span></code> is <code class="docutils literal notranslate"><span class="pre">srs.FindMatches</span></code>. <code class="docutils literal notranslate"><span class="pre">srs.FindMatches</span></code> returns a <em>matching</em> <code class="docutils literal notranslate"><span class="pre">srs_match</span></code> from a larger database, which is somewhat nested; for instance, use:<br></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">matches</span> <span class="o">=</span> <span class="n">srs</span><span class="o">.</span><span class="n">FindMatches</span><span class="p">()</span>
</pre></div>
</div>
<p>Then, <code class="docutils literal notranslate"><span class="pre">matches</span></code> looks like this: <code class="docutils literal notranslate"><span class="pre">[(osgeo.osr.SpatialReference,</span> <span class="pre">INT)]</span></code>. Therefore, a complete workaround for <code class="docutils literal notranslate"><span class="pre">srs.AutoIdentifyEPSG()</span></code> (or <code class="docutils literal notranslate"><span class="pre">in_sr.AutoIdentifyEPSG()</span></code> in the code block above) looks like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># set epsg and create spatial reference object</span>
<span class="n">epsg</span> <span class="o">=</span> <span class="mi">3857</span>
<span class="n">srs</span> <span class="o">=</span> <span class="n">osr</span><span class="o">.</span><span class="n">SpatialReference</span><span class="p">()</span>
<span class="n">srs</span><span class="o">.</span><span class="n">ImportFromEPSG</span><span class="p">(</span><span class="n">epsg</span><span class="p">)</span>

<span class="c1"># identify spatial reference</span>
<span class="n">auto_detect</span> <span class="o">=</span> <span class="n">srs</span><span class="o">.</span><span class="n">AutoIdentifyEPSG</span><span class="p">()</span>
<span class="k">if</span> <span class="n">auto_detect</span> <span class="ow">is</span> <span class="ow">not</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">srs</span> <span class="o">=</span> <span class="n">srs</span><span class="o">.</span><span class="n">FindMatches</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Find matches returns list of tuple of SpatialReferences</span>
    <span class="n">srs</span><span class="o">.</span><span class="n">AutoIdentifyEPSG</span><span class="p">()</span>  <span class="c1"># Re-perform auto-identification</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="add-fields-and-point-features-to-a-shapefile">
<span id="add-field"></span><h2>Add Fields and Point Features to a Shapefile<a class="headerlink" href="#add-fields-and-point-features-to-a-shapefile" title="Permalink to this headline">#</a></h2>
<p>A shapefile feature can be a point, a line, or a polygon, which has field attributes (e.g., <code class="docutils literal notranslate"><span class="pre">&quot;id&quot;=1</span></code> to describe that this is polygon number 1 or associated to an <code class="docutils literal notranslate"><span class="pre">id</span></code> block 1). Field attributes can be more than just an <em>ID</em>entifier and include, for example, the polygon area or city labels as in the above-shown example illustrating <em>cities.shp</em> (<code class="docutils literal notranslate"><span class="pre">shp_driver.Open(&quot;geodata/shapefiles/cities.shp&quot;)</span></code>).</p>
<p>To <strong>create a point shapefile</strong>, we can use the above-introduced <code class="docutils literal notranslate"><span class="pre">create_shp</span></code> function (or <code class="docutils literal notranslate"><span class="pre">flusstools.geotools.create_shp(shp_file_dir=&quot;&quot;)</span></code>) and set the projection with the <code class="docutils literal notranslate"><span class="pre">get_wkt()</span></code> function (also above introduced). The following code block shows the usage of both functions to create a <em>river.shp</em> point shapefile that contains three points located at three rivers in central Europe. The code block also illustrates the creation of a field in the attribute table and the creation of three point features. Here is how the code works:</p>
<ul class="simple">
<li><p>The shapefile is located in the <code class="docutils literal notranslate"><span class="pre">rivers_pts</span></code> variable. Note that the <code class="docutils literal notranslate"><span class="pre">layer_type</span></code> already determines the type of geometries that can be used in the shapefile. For instance, adding a line or polygon feature to an <code class="docutils literal notranslate"><span class="pre">ogr.wkbPoint</span></code> layer will result in an <code class="docutils literal notranslate"><span class="pre">ERROR</span> <span class="pre">1</span></code> message.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">basemap</span></code> (layer) is attributed to the variable <code class="docutils literal notranslate"><span class="pre">lyr</span> <span class="pre">=</span> <span class="pre">river_pts.GetLayer()</span></code>.</p></li>
<li><p>A <em>string</em>-type field is added and appended to the attribute table:</p>
<ul>
<li><p>instantiate a new field with <code class="docutils literal notranslate"><span class="pre">field_gname</span> <span class="pre">=</span> <span class="pre">ogr.FieldDefn(&quot;FIELD-NAME&quot;,</span> <span class="pre">ogr.OFTString)</span></code> (recall: the field name may not have more than 10 characters!)</p></li>
<li><p>append the new field to the shapefile with <code class="docutils literal notranslate"><span class="pre">lyr.CreateField(field_gname)</span></code></p></li>
<li><p>other field types than <code class="docutils literal notranslate"><span class="pre">OFTString</span></code> can be: <code class="docutils literal notranslate"><span class="pre">OFTInteger</span></code>, <code class="docutils literal notranslate"><span class="pre">OFTReal</span></code>, <code class="docutils literal notranslate"><span class="pre">OFTDate</span></code>, <code class="docutils literal notranslate"><span class="pre">OFTTime</span></code>, <code class="docutils literal notranslate"><span class="pre">OFTDateTime</span></code>, <code class="docutils literal notranslate"><span class="pre">OFTBinary</span></code>, <code class="docutils literal notranslate"><span class="pre">OFTIntegerList</span></code>, <code class="docutils literal notranslate"><span class="pre">OFTRealList</span></code>, or <code class="docutils literal notranslate"><span class="pre">OFTStringList</span></code>.</p></li>
</ul>
</li>
<li><p>Add three points stored in <code class="docutils literal notranslate"><span class="pre">pt_names</span> <span class="pre">=</span> <span class="pre">{RIVER-NAME:</span> <span class="pre">(x-coordinate,</span> <span class="pre">y-coordinate)}</span></code> in a loop over the dictionary keys:</p>
<ul>
<li><p>for every new point, create a feature as a child of the layer defintions with <code class="docutils literal notranslate"><span class="pre">feature</span> <span class="pre">=</span> <span class="pre">ogr.Feature(lyr.GetLayerDefn())</span></code></p></li>
<li><p>set the value of the field name for every point with <code class="docutils literal notranslate"><span class="pre">feature.SetField(FIELD-NAME,</span> <span class="pre">FIELD-VALUE)</span></code></p></li>
<li><p>create a string of the new point in WKT format with <code class="docutils literal notranslate"><span class="pre">wkt</span> <span class="pre">=</span> <span class="pre">&quot;POINT(X-COORDINATE</span> <span class="pre">Y-COORDINATE)&quot;</span></code></p></li>
<li><p>convert the WKT-formatted point into a point-type geometry with <code class="docutils literal notranslate"><span class="pre">point</span> <span class="pre">=</span> <span class="pre">ogr.CreateGeometryFromWkt(wkt)</span></code></p></li>
<li><p>set the new point as the new feature’s geometry with <code class="docutils literal notranslate"><span class="pre">feature.SetGeometry(point)</span></code></p></li>
<li><p>append the new feature to the layer with <code class="docutils literal notranslate"><span class="pre">lyr.CreateFeature(feature)</span></code></p></li>
</ul>
</li>
<li><p>Unlock (release) the shapefile by overwriting the <code class="docutils literal notranslate"><span class="pre">lyr</span></code> and <code class="docutils literal notranslate"><span class="pre">river_pts</span></code> variable with <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p></li>
</ul>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The operations are not written to the shapefile if the <code class="docutils literal notranslate"><span class="pre">lyr</span></code> and <code class="docutils literal notranslate"><span class="pre">river_pts</span></code> objects are not overwritten with <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">shp_dir</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/geodata/shapefiles/rivers.shp&quot;</span>
<span class="n">river_pts</span> <span class="o">=</span> <span class="n">create_shp</span><span class="p">(</span><span class="n">shp_dir</span><span class="p">,</span> <span class="n">layer_name</span><span class="o">=</span><span class="s2">&quot;basemap&quot;</span><span class="p">,</span> <span class="n">layer_type</span><span class="o">=</span><span class="s2">&quot;point&quot;</span><span class="p">)</span>

<span class="c1"># create .prj file for the shapefile for web application references</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">shp_dir</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.shp&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.prj&quot;</span><span class="p">,</span> <span class="s2">&quot;w+&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">prj</span><span class="p">:</span>
    <span class="n">prj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">get_wkt</span><span class="p">(</span><span class="mi">3857</span><span class="p">))</span>

<span class="c1"># get basemap layer</span>
<span class="n">lyr</span> <span class="o">=</span> <span class="n">river_pts</span><span class="o">.</span><span class="n">GetLayer</span><span class="p">()</span>

<span class="c1"># add string field &quot;rivername&quot;</span>
<span class="n">field_gname</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">FieldDefn</span><span class="p">(</span><span class="s2">&quot;rivername&quot;</span><span class="p">,</span> <span class="n">ogr</span><span class="o">.</span><span class="n">OFTString</span><span class="p">)</span>
<span class="n">lyr</span><span class="o">.</span><span class="n">CreateField</span><span class="p">(</span><span class="n">field_gname</span><span class="p">)</span>

<span class="c1"># names and coordinates of central EU rivers in EPSG:3857 WG84 / Pseudo-Mercator</span>
<span class="n">pt_names</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Aare&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">916136.03</span><span class="p">,</span> <span class="mf">6038687.72</span><span class="p">),</span>
            <span class="s2">&quot;Ain&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">623554.12</span><span class="p">,</span> <span class="mf">5829154.69</span><span class="p">),</span>
            <span class="s2">&quot;Inn&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1494878.95</span><span class="p">,</span> <span class="mf">6183793.83</span><span class="p">)}</span>

<span class="c1"># add the three rivers as points to the basemap layer</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">pt_names</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="c1"># create Feature as child of the layer</span>
    <span class="n">pt_feature</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">Feature</span><span class="p">(</span><span class="n">lyr</span><span class="o">.</span><span class="n">GetLayerDefn</span><span class="p">())</span>
    <span class="c1"># define value n (river) in the rivername field</span>
    <span class="n">pt_feature</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="s2">&quot;rivername&quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="c1"># use WKT format to add a point geometry to the Feature</span>
    <span class="n">wkt</span> <span class="o">=</span> <span class="s2">&quot;POINT(</span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">pt_names</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">pt_names</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">point</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">CreateGeometryFromWkt</span><span class="p">(</span><span class="n">wkt</span><span class="p">)</span>
    <span class="n">pt_feature</span><span class="o">.</span><span class="n">SetGeometry</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
    <span class="c1"># append the new feature to the basement layer</span>
    <span class="n">lyr</span><span class="o">.</span><span class="n">CreateFeature</span><span class="p">(</span><span class="n">pt_feature</span><span class="p">)</span>
    
<span class="c1"># release files</span>
<span class="n">lyr</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">river_pts</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<p>The resulting <code class="docutils literal notranslate"><span class="pre">rivers.shp</span></code> shapefile can be imported in QGIS along with a DEM from the <a class="reference external" href="http://naciscdn.org/naturalearth/packages/Natural_Earth_quick_start.zip">Natural Earth quick start kit</a>.</p>
<figure class="align-default" id="qgis-rivers-py">
<img alt="river map shapefile" src="../_images/qgis-rivers.png" />
<figcaption>
<p><span class="caption-number">Fig. 44 </span><span class="caption-text">The river names bound to points in a point shapefile shown in QGIS.</span><a class="headerlink" href="#qgis-rivers-py" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="multiline-polyline-shapefile">
<span id="line-create"></span><h2>Multiline (Polyline) Shapefile<a class="headerlink" href="#multiline-polyline-shapefile" title="Permalink to this headline">#</a></h2>
<p>Similar to the procedure for creating and adding points to a new point shapefile, a (multi) line (or polyline) can be added to a shapefile. The <code class="docutils literal notranslate"><span class="pre">create_shp</span></code> function creates a multi-line shapefile when the layer type is defined as <code class="docutils literal notranslate"><span class="pre">&quot;line&quot;</span></code> (<code class="docutils literal notranslate"><span class="pre">flusstools.geotools.create_shp(shp_file_dir=&quot;&quot;,</span> <span class="pre">layer_type=&quot;line&quot;)</span></code>). The coordinate system is created with the above-defined <code class="docutils literal notranslate"><span class="pre">get_wkt()</span></code> function.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The term <em>multi-line</em> is used in <em>OGC</em> and <code class="docutils literal notranslate"><span class="pre">ogr</span></code>, while <em>polyline</em> is used in Esri GIS environments.</p>
</div>
<p>The following code block uses the coordinates of cities along the Rhine River, stored in a <em>dictionary</em> named <code class="docutils literal notranslate"><span class="pre">station_names</span></code>. The city names are not used and only the coordinates are appended with <code class="docutils literal notranslate"><span class="pre">line.AddPoint(X,</span> <span class="pre">Y)</span></code>. As before, a field is created to give the river a name. The actual line feature is again created as a child of the layer with <code class="docutils literal notranslate"><span class="pre">line_feature</span> <span class="pre">=</span> <span class="pre">ogr.Feature(lyr.GetLayerDefn())</span></code>. Running this code block produces a line that approximately follows the Rhine River between France and Germany.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">shp_dir</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/geodata/shapefiles/rhine_proxy.shp&quot;</span>
<span class="n">rhine_line</span> <span class="o">=</span> <span class="n">create_shp</span><span class="p">(</span><span class="n">shp_dir</span><span class="p">,</span> <span class="n">layer_name</span><span class="o">=</span><span class="s2">&quot;basemap&quot;</span><span class="p">,</span> <span class="n">layer_type</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">)</span>

<span class="c1"># create .prj file for the shapefile for web application references</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">shp_dir</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.shp&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.prj&quot;</span><span class="p">,</span> <span class="s2">&quot;w+&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">prj</span><span class="p">:</span>
    <span class="n">prj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">get_wkt</span><span class="p">(</span><span class="mi">3857</span><span class="p">))</span>

<span class="c1"># get basemap layer</span>
<span class="n">lyr</span> <span class="o">=</span> <span class="n">rhine_line</span><span class="o">.</span><span class="n">GetLayer</span><span class="p">()</span>

<span class="c1"># coordinates for EPSG:3857 WG84 / Pseudo-Mercator</span>
<span class="n">station_names</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Basel&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">844361.68</span><span class="p">,</span> <span class="mf">6035047.42</span><span class="p">),</span>
                 <span class="s2">&quot;Kembs&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">835724.27</span><span class="p">,</span> <span class="mf">6056449.76</span><span class="p">),</span>
                 <span class="s2">&quot;Breisach&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">842565.32</span><span class="p">,</span> <span class="mf">6111140.43</span><span class="p">),</span>
                 <span class="s2">&quot;Rhinau&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">857547.04</span><span class="p">,</span> <span class="mf">6158569.58</span><span class="p">),</span>
                 <span class="s2">&quot;Strasbourg&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">868439.31</span><span class="p">,</span> <span class="mf">6203189.68</span><span class="p">)}</span>

<span class="c1"># create line object and add points from station names</span>
<span class="n">line</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">Geometry</span><span class="p">(</span><span class="n">ogr</span><span class="o">.</span><span class="n">wkbLineString</span><span class="p">)</span>
<span class="k">for</span> <span class="n">stn</span> <span class="ow">in</span> <span class="n">station_names</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
    <span class="n">line</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="n">stn</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">stn</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># create field named &quot;river&quot;</span>
<span class="n">field_name</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">FieldDefn</span><span class="p">(</span><span class="s2">&quot;river&quot;</span><span class="p">,</span> <span class="n">ogr</span><span class="o">.</span><span class="n">OFTString</span><span class="p">)</span>
<span class="n">lyr</span><span class="o">.</span><span class="n">CreateField</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>

<span class="c1"># create feature, geometry, and field entry</span>
<span class="n">line_feature</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">Feature</span><span class="p">(</span><span class="n">lyr</span><span class="o">.</span><span class="n">GetLayerDefn</span><span class="p">())</span>
<span class="n">line_feature</span><span class="o">.</span><span class="n">SetGeometry</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<span class="n">line_feature</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="s2">&quot;river&quot;</span><span class="p">,</span> <span class="s2">&quot;Rhine&quot;</span><span class="p">)</span>

<span class="c1"># add feature to layer</span>
<span class="n">lyr</span><span class="o">.</span><span class="n">CreateFeature</span><span class="p">(</span><span class="n">line_feature</span><span class="p">)</span>

<span class="n">lyr</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">rhine_line</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<p>The resulting <code class="docutils literal notranslate"><span class="pre">rhine_proxy.shp</span></code> shapefile can be imported in QGIS along with a DEM and the cities point shapefile from the <a class="reference external" href="http://naciscdn.org/naturalearth/packages/Natural_Earth_quick_start.zip">Natural Earth quick start kit</a>.</p>
<figure class="align-default" id="qgis-rhine-py">
<img alt="rhine line shapefile" src="../_images/qgis-rhine.png" />
<figcaption>
<p><span class="caption-number">Fig. 45 </span><span class="caption-text">The line approximating the Rhine river in QGIS.</span><a class="headerlink" href="#qgis-rhine-py" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="polygon-shapefile">
<span id="poly-create"></span><h2>Polygon Shapefile<a class="headerlink" href="#polygon-shapefile" title="Permalink to this headline">#</a></h2>
<p>Polygons are surface patches that can be created point-by-point, line-by-line, or from a <code class="docutils literal notranslate"><span class="pre">&quot;Multipolygon&quot;</span></code> WKB definition. When creating polygons from points or lines, we want to create a surface and this is why the corresponding geometry type is called <code class="docutils literal notranslate"><span class="pre">wkbLinearRing</span></code> for building polygons from both points or lines (rather than <code class="docutils literal notranslate"><span class="pre">wkbPoint</span></code> or <code class="docutils literal notranslate"><span class="pre">wkbLine</span></code>, respectively). The following code block features an example for building a polygon shapefile delineating the hydraulic laboratory of the University of Stuttgart. The difference between the above example for creating a line shapefile are:</p>
<ul class="simple">
<li><p>The projection is <code class="docutils literal notranslate"><span class="pre">EPSG:4326</span></code>.</p></li>
<li><p>The point coordinates are generated within an <code class="docutils literal notranslate"><span class="pre">ogr.wkbLinearRing</span></code> object step-by-step rather than in a loop over <em>dictionary</em> entries.</p></li>
<li><p>File, variable, and field names.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">shp_dir</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/geodata/shapefiles/va4wasserbau.shp&quot;</span>
<span class="n">va_geo</span> <span class="o">=</span> <span class="n">create_shp</span><span class="p">(</span><span class="n">shp_dir</span><span class="p">,</span> <span class="n">layer_name</span><span class="o">=</span><span class="s2">&quot;basemap&quot;</span><span class="p">,</span> <span class="n">layer_type</span><span class="o">=</span><span class="s2">&quot;polygon&quot;</span><span class="p">)</span>

<span class="c1"># create .prj file for the shapefile for GIS map applications</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">shp_dir</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.shp&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.prj&quot;</span><span class="p">,</span> <span class="s2">&quot;w+&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">prj</span><span class="p">:</span>
    <span class="n">prj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">get_wkt</span><span class="p">(</span><span class="mi">4326</span><span class="p">))</span>

<span class="c1"># get basemap layer</span>
<span class="n">lyr</span> <span class="o">=</span> <span class="n">va_geo</span><span class="o">.</span><span class="n">GetLayer</span><span class="p">()</span>

<span class="c1"># create polygon points</span>
<span class="n">pts</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">Geometry</span><span class="p">(</span><span class="n">ogr</span><span class="o">.</span><span class="n">wkbLinearRing</span><span class="p">)</span>
<span class="n">pts</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="mf">9.103686</span><span class="p">,</span> <span class="mf">48.744251</span><span class="p">)</span>
<span class="n">pts</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="mf">9.104689</span><span class="p">,</span> <span class="mf">48.744198</span><span class="p">)</span>
<span class="n">pts</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="mf">9.104667</span><span class="p">,</span> <span class="mf">48.743960</span><span class="p">)</span>
<span class="n">pts</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="mf">9.103557</span><span class="p">,</span> <span class="mf">48.744009</span><span class="p">)</span>

<span class="c1"># create polygon geometry</span>
<span class="n">poly</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">Geometry</span><span class="p">(</span><span class="n">ogr</span><span class="o">.</span><span class="n">wkbPolygon</span><span class="p">)</span>
<span class="c1"># build polygon geometry from points</span>
<span class="n">poly</span><span class="o">.</span><span class="n">AddGeometry</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span>

<span class="c1"># add field to classify building type</span>
<span class="n">field</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">FieldDefn</span><span class="p">(</span><span class="s2">&quot;building&quot;</span><span class="p">,</span> <span class="n">ogr</span><span class="o">.</span><span class="n">OFTString</span><span class="p">)</span>
<span class="n">lyr</span><span class="o">.</span><span class="n">CreateField</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>

<span class="n">poly_feature_defn</span> <span class="o">=</span> <span class="n">lyr</span><span class="o">.</span><span class="n">GetLayerDefn</span><span class="p">()</span>
<span class="n">poly_feature</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">Feature</span><span class="p">(</span><span class="n">poly_feature_defn</span><span class="p">)</span>
<span class="n">poly_feature</span><span class="o">.</span><span class="n">SetGeometry</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
<span class="n">poly_feature</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="s2">&quot;building&quot;</span><span class="p">,</span> <span class="s2">&quot;Versuchsanstalt&quot;</span><span class="p">)</span>

<span class="n">lyr</span><span class="o">.</span><span class="n">CreateFeature</span><span class="p">(</span><span class="n">poly_feature</span><span class="p">)</span>

<span class="n">lyr</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">va_geo</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="build-shapefile-from-json">
<span id="json-create"></span><h2>Build Shapefile from JSON<a class="headerlink" href="#build-shapefile-from-json" title="Permalink to this headline">#</a></h2>
<p>Loading geometry data from in-line defined variables is cumbersome in practice, where geospatial data are often provided on public platforms (e.g., land use or cover).  The following example uses a JSON file generated with map service data from the <a class="reference external" href="https://udo.lubw.baden-wuerttemberg.de/">Baden-Württemberg State Institute for the Environment, Survey and Nature Conservation (LUBW)</a>, where polygon nodes are stored in WKB polygon geometry format  (<code class="docutils literal notranslate"><span class="pre">&quot;MultiPolygon</span> <span class="pre">(((node1_x</span> <span class="pre">node1_y,</span> <span class="pre">nodej_x,</span> <span class="pre">nodej_y,</span> <span class="pre">...</span> <span class="pre">...)))&quot;</span></code>):</p>
<ul class="simple">
<li><p>The JSON file (<a class="reference external" href="https://raw.githubusercontent.com/hydro-informatics/jupyter-python-course/main/geodata/json/hq100-dreisam.json">download hq100-dreisam.json</a> and save it to a subdirectory called <code class="docutils literal notranslate"><span class="pre">/geodata/json/</span></code>)is read with <a class="reference internal" href="pynum.html#pandas"><span class="std std-ref">Pandas</span></a> and the shapefile is created, as before, with the <code class="docutils literal notranslate"><span class="pre">create_shp</span></code> function.</p></li>
<li><p>The projection is <code class="docutils literal notranslate"><span class="pre">EPSG:25832</span></code>.</p></li>
<li><p>Two fields are added in the form of</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;tbg_name&quot;</span></code> (the original string name of the polygons in the LUBW data), and</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;area&quot;</span></code> (a real number field, in which the polygon area is calculated in m<sup>2</sup> using <code class="docutils literal notranslate"><span class="pre">polygon.GetArea()</span></code>).</p></li>
</ul>
</li>
<li><p>The polygon geometries are derived from the WKB-formatted definitions in the <code class="docutils literal notranslate"><span class="pre">&quot;wkb_geom&quot;</span></code> field of the pandas dataframe object <code class="docutils literal notranslate"><span class="pre">dreisam_inundation</span></code>.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get data from json file</span>
<span class="n">dreisam_inundation</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/geodata/json/hq100-dreisam.json&quot;</span><span class="p">)</span>

<span class="c1"># create shapefile</span>
<span class="n">shp_dir</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/geodata/shapefiles/dreisam_hq100.shp&quot;</span>
<span class="n">dreisam_hq100</span> <span class="o">=</span> <span class="n">create_shp</span><span class="p">(</span><span class="n">shp_dir</span><span class="p">,</span> <span class="n">layer_name</span><span class="o">=</span><span class="s2">&quot;basemap&quot;</span><span class="p">,</span> <span class="n">layer_type</span><span class="o">=</span><span class="s2">&quot;polygon&quot;</span><span class="p">)</span>

<span class="c1"># create .prj file for the shapefile for GIS map applications</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">shp_dir</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.shp&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.prj&quot;</span><span class="p">,</span> <span class="s2">&quot;w+&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">prj</span><span class="p">:</span>
    <span class="n">prj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">get_wkt</span><span class="p">(</span><span class="mi">25832</span><span class="p">))</span>

<span class="c1"># get basemap layer</span>
<span class="n">lyr</span> <span class="o">=</span> <span class="n">dreisam_hq100</span><span class="o">.</span><span class="n">GetLayer</span><span class="p">()</span>

<span class="c1"># add string field &quot;tbg_name&quot;</span>
<span class="n">lyr</span><span class="o">.</span><span class="n">CreateField</span><span class="p">(</span><span class="n">ogr</span><span class="o">.</span><span class="n">FieldDefn</span><span class="p">(</span><span class="s2">&quot;tbg_name&quot;</span><span class="p">,</span> <span class="n">ogr</span><span class="o">.</span><span class="n">OFTString</span><span class="p">))</span>

<span class="c1"># add string field &quot;area&quot;</span>
<span class="n">lyr</span><span class="o">.</span><span class="n">CreateField</span><span class="p">(</span><span class="n">ogr</span><span class="o">.</span><span class="n">FieldDefn</span><span class="p">(</span><span class="s2">&quot;area&quot;</span><span class="p">,</span> <span class="n">ogr</span><span class="o">.</span><span class="n">OFTReal</span><span class="p">))</span>

<span class="k">for</span> <span class="n">wkt</span><span class="p">,</span> <span class="n">tbg</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dreisam_inundation</span><span class="p">[</span><span class="s2">&quot;wkt_geom&quot;</span><span class="p">],</span> <span class="n">dreisam_inundation</span><span class="p">[</span><span class="s2">&quot;TBG_NAME&quot;</span><span class="p">]):</span>
    <span class="c1"># create Feature as child of the layer</span>
    <span class="n">feature</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">Feature</span><span class="p">(</span><span class="n">lyr</span><span class="o">.</span><span class="n">GetLayerDefn</span><span class="p">())</span>
    <span class="c1"># assign tbg_name</span>
    <span class="n">feature</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="s2">&quot;tbg_name&quot;</span><span class="p">,</span> <span class="n">tbg</span><span class="p">)</span>
    <span class="c1"># use WKT format to add a polygon geometry to the Feature</span>
    <span class="n">polygon</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">CreateGeometryFromWkt</span><span class="p">(</span><span class="n">wkt</span><span class="p">)</span>
    <span class="c1"># define default value of 0 to the area field</span>
    <span class="n">feature</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="s2">&quot;area&quot;</span><span class="p">,</span> <span class="n">polygon</span><span class="o">.</span><span class="n">GetArea</span><span class="p">())</span>

    <span class="n">feature</span><span class="o">.</span><span class="n">SetGeometry</span><span class="p">(</span><span class="n">polygon</span><span class="p">)</span>
    <span class="c1"># append the new feature to the basement layer</span>
    <span class="n">lyr</span><span class="o">.</span><span class="n">CreateFeature</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>

<span class="n">lyr</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">dreisam_hq100</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Open the new <code class="docutils literal notranslate"><span class="pre">dreisam_hq100.shp</span></code> in QGIS and explore the attribute table.</p>
</div>
<p>Also <em>GeoJSON</em> data can be used to create an <code class="docutils literal notranslate"><span class="pre">ogr.Geometry</span></code> with <code class="docutils literal notranslate"><span class="pre">ogr.createFromGeoJson(FILENAME)</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">ogr</span>
<span class="n">geojson_data</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;{&quot;type&quot;:&quot;Point&quot;,&quot;coordinates&quot;:[1013452.282805,6231540.674235]}&quot;&quot;&quot;</span>
<span class="n">point</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">CreateGeometryFromJson</span><span class="p">(</span><span class="n">geojson_data</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;X=</span><span class="si">%d</span><span class="s2">, Y=</span><span class="si">%d</span><span class="s2"> (EPSG:3857)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">GetX</span><span class="p">(),</span> <span class="n">point</span><span class="o">.</span><span class="n">GetY</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>X=1013452, Y=6231540 (EPSG:3857)
</pre></div>
</div>
</div>
</div>
</section>
<section id="calculate-geometric-attributes">
<span id="calc"></span><h2>Calculate Geometric Attributes<a class="headerlink" href="#calculate-geometric-attributes" title="Permalink to this headline">#</a></h2>
<p>The above code block illustrates the usage of <code class="docutils literal notranslate"><span class="pre">polygon.GetArea()</span></code> to calculate the polygon area in m<span class="math notranslate nohighlight">\(^2\)</span>. The <code class="docutils literal notranslate"><span class="pre">ogr</span></code> library provides many more functions to calculate geometric attributes of features and here is a summary:</p>
<ul class="simple">
<li><p>Unify multiple polygons <br>
<code class="docutils literal notranslate"><span class="pre">wkt_...</span> <span class="pre">=</span> <span class="pre">...</span></code><br>
<code class="docutils literal notranslate"><span class="pre">polygon_a</span> <span class="pre">=</span> <span class="pre">ogr.CreateGeometryFromWkt(wkt_1)</span></code><br>
<code class="docutils literal notranslate"><span class="pre">polygon_b</span> <span class="pre">=</span> <span class="pre">ogr.CreateGeometryFromWkt(wkt_2)</span></code><br>
<code class="docutils literal notranslate"><span class="pre">polygon_union</span> <span class="pre">=</span> <span class="pre">polygon_a.Union(polygon_b)</span></code></p></li>
<li><p>Intersect two polygons <br>
<code class="docutils literal notranslate"><span class="pre">polygon_intersection</span> <span class="pre">=</span> <span class="pre">polygon_a.Intersection(polygon_b)</span></code></p></li>
<li><p>Envelope (minimum and maximum extents) of a polygon <br>
<code class="docutils literal notranslate"><span class="pre">env</span> <span class="pre">=</span> <span class="pre">polygon.GetEnvelope()</span></code> <br>
<code class="docutils literal notranslate"><span class="pre">print(&quot;minX:</span> <span class="pre">%d,</span> <span class="pre">minY:</span> <span class="pre">%d,</span> <span class="pre">maxX:</span> <span class="pre">%d,</span> <span class="pre">maxY:</span> <span class="pre">%d&quot;</span> <span class="pre">%</span> <span class="pre">(env[0],env[2],env[1],env[3])</span></code></p></li>
<li><p>Convex hull (envelope surface) of multiple geometries (points, lines, polygons) <br>
<code class="docutils literal notranslate"><span class="pre">all_polygons</span> <span class="pre">=</span> <span class="pre">ogr.Geometry(ogr.wkbGeometryCollection)</span></code><br>
<code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">feature</span> <span class="pre">in</span> <span class="pre">POLYGON-SOURCE-LAYER:</span> <span class="pre">all_polygons.AddGeometry(feature.GetGeometryRef())</span></code><br>
<code class="docutils literal notranslate"><span class="pre">convexhull</span> <span class="pre">=</span> <span class="pre">all_polygons.ConvexHull()</span></code><br>
Save <code class="docutils literal notranslate"><span class="pre">convexhull</span></code> to shapefile (use the <code class="docutils literal notranslate"><span class="pre">create_shp</span></code> function as shown in the above examples or read more at <a class="reference external" href="https://pcjericks.github.io/py-gdalogr-cookbook/vector_layers.html#save-the-convex-hull-of-all-geometry-from-an-input-layer-to-an-output-layer">pcjerick’s Github pages</a>)<br>
Tip: To create a tight hull (e.g., of a point cloud), look for <code class="docutils literal notranslate"><span class="pre">concavehull</span></code> functions.</p></li>
<li><p>Length (of a line) <br>
<code class="docutils literal notranslate"><span class="pre">wkt</span> <span class="pre">=</span> <span class="pre">&quot;LINESTRING</span> <span class="pre">(415128.5</span> <span class="pre">5320979.5,</span> <span class="pre">415128.6</span> <span class="pre">5320974.5,</span> <span class="pre">415129.75</span> <span class="pre">5320974.7)&quot;</span></code><br>
<code class="docutils literal notranslate"><span class="pre">line</span> <span class="pre">=</span> <span class="pre">ogr.CreateGeometryFromWkt(wkt)</span></code><br>
<code class="docutils literal notranslate"><span class="pre">print(&quot;Length</span> <span class="pre">=</span> <span class="pre">%d&quot;</span> <span class="pre">%</span> <span class="pre">line.Length())</span></code></p></li>
<li><p>Area (of a polygon):  <code class="docutils literal notranslate"><span class="pre">polygon.GetArea()</span></code> (see above example)</p></li>
<li><p>Example to calculate <a class="reference external" href="https://pcjericks.github.io/py-gdalogr-cookbook/geometry.html#quarter-polygon-and-create-centroids">centroid coordinates of polygons</a>.</p></li>
</ul>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The units of the geometric attribute (e.g., m<span class="math notranslate nohighlight">\(^2\)</span>, U.S. feet, or others) are calculated based on the definitions in the <code class="docutils literal notranslate"><span class="pre">.prj</span> <span class="pre">file</span> <span class="pre">&lt;prjp&gt;</span></code> (recall the definition of projections in WKT format in the <a class="reference internal" href="../geopy/geospatial-data.html#prj"><span class="std std-ref">Projections and Coordinate Systems</span></a> section).</p>
</div>
</section>
<section id="export-to-other-formats">
<span id="export"></span><h2>Export to Other Formats<a class="headerlink" href="#export-to-other-formats" title="Permalink to this headline">#</a></h2>
<p>The above examples deal with <code class="docutils literal notranslate"><span class="pre">.shp</span></code> files only, but other formats can be useful (e.g., to create web applications or export to <em>Google Earth</em>). To this end, the following paragraphs illustrate the creation of GeoJSON and KML files. Several other conversions can be performed, not only between file formats but also between feature types. For instance, polygons can be created from point clouds (among others with the <code class="docutils literal notranslate"><span class="pre">ConvexHull</span></code> method mentioned above). Interested students can learn more about conversions in <a class="reference external" href="https://github.com/mdiener21/python-geospatial-analysis-cookbook">Michael Diener’s <em>Python Geospatial Analysis Cookbook</em></a>.</p>
<section id="geojson">
<h3>GeoJSON<a class="headerlink" href="#geojson" title="Permalink to this headline">#</a></h3>
<p>GeoJSON files can be easily created as before, even without activating a driver:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">triangle</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">Geometry</span><span class="p">(</span><span class="n">ogr</span><span class="o">.</span><span class="n">wkbLinearRing</span><span class="p">)</span>
<span class="n">triangle</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="o">-</span><span class="mf">11717151.498691</span><span class="p">,</span> <span class="mf">2356192.894805</span><span class="p">)</span>
<span class="n">triangle</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="o">-</span><span class="mf">11717120.446149</span><span class="p">,</span> <span class="mf">2355586.175893</span><span class="p">)</span>
<span class="n">triangle</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="o">-</span><span class="mf">11719392.059083</span><span class="p">,</span> <span class="mf">2354012.050842</span><span class="p">)</span>

<span class="n">polygon</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">Geometry</span><span class="p">(</span><span class="n">ogr</span><span class="o">.</span><span class="n">wkbPolygon</span><span class="p">)</span>
<span class="n">polygon</span><span class="o">.</span><span class="n">AddGeometry</span><span class="p">(</span><span class="n">triangle</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/geodata/geojson/pitillal-triangle.geojson&quot;</span><span class="p">,</span> <span class="s2">&quot;w+&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">gjson</span><span class="p">:</span>
    <span class="n">gjson</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">polygon</span><span class="o">.</span><span class="n">ExportToJson</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<p>For more robust file handling and defining a projection, activate the driver <code class="docutils literal notranslate"><span class="pre">ogr.GetDriverByName(&quot;GeoJSON&quot;)</span></code>. Thus, the creation and manipulation of GeoJSON files work similarly to the shapefile handlers shown above.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gjson_driver</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">GetDriverByName</span><span class="p">(</span><span class="s2">&quot;GeoJSON&quot;</span><span class="p">)</span>

<span class="c1"># make spatial reference</span>
<span class="n">sr</span> <span class="o">=</span> <span class="n">osr</span><span class="o">.</span><span class="n">SpatialReference</span><span class="p">()</span>
<span class="n">sr</span><span class="o">.</span><span class="n">ImportFromEPSG</span><span class="p">(</span><span class="mi">3857</span><span class="p">)</span>

<span class="c1"># create GeoJSON file</span>
<span class="n">gjson</span> <span class="o">=</span> <span class="n">gjson_driver</span><span class="o">.</span><span class="n">CreateDataSource</span><span class="p">(</span><span class="s2">&quot;pitillal-full.geojson&quot;</span><span class="p">)</span>
<span class="n">gjson_lyr</span> <span class="o">=</span> <span class="n">gjson</span><span class="o">.</span><span class="n">CreateLayer</span><span class="p">(</span><span class="s2">&quot;pitillal-full.geojson&quot;</span><span class="p">,</span> <span class="n">geom_type</span><span class="o">=</span><span class="n">ogr</span><span class="o">.</span><span class="n">wkbPolygon</span><span class="p">,</span> <span class="n">srs</span><span class="o">=</span><span class="n">sr</span><span class="p">)</span>

<span class="c1"># get layer feature definitions</span>
<span class="n">feature_def</span> <span class="o">=</span> <span class="n">gjson_lyr</span><span class="o">.</span><span class="n">GetLayerDefn</span><span class="p">()</span>
<span class="c1"># create new feature</span>
<span class="n">new_feature</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">Feature</span><span class="p">(</span><span class="n">feature_def</span><span class="p">)</span>
<span class="c1"># assign the triangle from the above code block</span>
<span class="n">new_feature</span><span class="o">.</span><span class="n">SetGeometry</span><span class="p">(</span><span class="n">polygon</span><span class="p">)</span>
<span class="c1"># add new feature to Layer</span>
<span class="n">gjson_lyr</span><span class="o">.</span><span class="n">CreateFeature</span><span class="p">(</span><span class="n">new_feature</span><span class="p">)</span>

<span class="c1"># close links to data sources</span>
<span class="n">gjson</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">gjson_lyr</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="kml-google-earth">
<h3>KML (Google Earth)<a class="headerlink" href="#kml-google-earth" title="Permalink to this headline">#</a></h3>
<p>To display point, line, or polygon features in Google Earth, features can be plugged into Google’s <a class="reference external" href="https://developers.google.com/kml/documentation/kml_tut">KML</a> (Keyhole Markup Language), similar to the creation of a GeoJSON file, and with the function <code class="docutils literal notranslate"><span class="pre">geometry.ExportToKML</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">triangle</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">Geometry</span><span class="p">(</span><span class="n">ogr</span><span class="o">.</span><span class="n">wkbLinearRing</span><span class="p">)</span>
<span class="n">triangle</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="o">-</span><span class="mf">11717151.498691</span><span class="p">,</span> <span class="mf">2356192.894805</span><span class="p">)</span>
<span class="n">triangle</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="o">-</span><span class="mf">11717120.446149</span><span class="p">,</span> <span class="mf">2355586.175893</span><span class="p">)</span>
<span class="n">triangle</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="o">-</span><span class="mf">11719392.059083</span><span class="p">,</span> <span class="mf">2354012.050842</span><span class="p">)</span>

<span class="n">polygon</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">Geometry</span><span class="p">(</span><span class="n">ogr</span><span class="o">.</span><span class="n">wkbPolygon</span><span class="p">)</span>
<span class="n">polygon</span><span class="o">.</span><span class="n">AddGeometry</span><span class="p">(</span><span class="n">triangle</span><span class="p">)</span>

<span class="c1">#geojson = poly.ExportToJson()</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/geodata/pitillal-triangle.kml&quot;</span><span class="p">,</span> <span class="s2">&quot;w+&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">gjson</span><span class="p">:</span>
    <span class="n">gjson</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">polygon</span><span class="o">.</span><span class="n">ExportToKML</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<p>Moreover, similar to GeoJSON files and shapefiles, KML files can be generated more robustly (with a defined projection, for example). All you need to do is initiating the KML driver (<code class="docutils literal notranslate"><span class="pre">kml_driver</span> <span class="pre">=</span> <span class="pre">ogr.GetDriverByName(&quot;KML&quot;)</span></code>) and define a KML data source (<code class="docutils literal notranslate"><span class="pre">kml_file</span> <span class="pre">=</span> <span class="pre">kml_driver.CreateDataSource(FILENAME.KML)</span></code>).</p>
<div class="admonition-exercise admonition">
<p class="admonition-title">Exercise</p>
<p>Familiarize with shapefile handling in the <a class="reference internal" href="../exercises/ex-geco.html#ex-geco"><span class="std std-ref">geospatial ecohydraulics</span></a> exercise.</p>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "hydro-informatics/jupyter-python-course",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./jupyter"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="../geopy/geo-pckg.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Geospatial Open Source Python Libraries</p>
      </div>
    </a>
    <a class="right-next"
       href="geo-raster.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Raster (Grid) Handling</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#load-an-existing-shapefile">Load an Existing Shapefile</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-a-new-shapefile">Create a New Shapefile</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#get-and-set-shapefile-projections">Get and Set Shapefile Projections</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#transform-re-project-a-shapefile">Transform (Re-project) a Shapefile</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#add-fields-and-point-features-to-a-shapefile">Add Fields and Point Features to a Shapefile</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multiline-polyline-shapefile">Multiline (Polyline) Shapefile</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#polygon-shapefile">Polygon Shapefile</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#build-shapefile-from-json">Build Shapefile from JSON</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculate-geometric-attributes">Calculate Geometric Attributes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#export-to-other-formats">Export to Other Formats</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#geojson">GeoJSON</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kml-google-earth">KML (Google Earth)</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Sebastian Schwindt, Beatriz Negreiros, Federica Scolari, Ricardo Barros
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>