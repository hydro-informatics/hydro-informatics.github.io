

<!DOCTYPE html>


<html >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Convergence (Quantitative) &#8212; Hydro-Informatics</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script src="../../_static/tabs.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"TeX": {"Macros": {"N": "\\mathbb{N}", "floor": ["\\lfloor#1\\rfloor", 1], "bmat": ["\\left[\\begin{array}"], "emat": ["\\end{array}\\right]"]}}, "options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'numerics/telemac/convergence';</script>
    <link rel="canonical" href="https://hydro-informatics.com/numerics/telemac/convergence.html" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Mass Conservation" href="mass-optimization.html" />
    <link rel="prev" title="Boundary Conditions" href="boundaries.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="None"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
    
    
      
    
    
    <img src="../../_static/icon.jpg" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../../_static/icon.jpg" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Get Started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../lectures/classroom.html">The Virtual Classroom</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../lectures/principles.html">Principles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../lectures/overview.html">Lectures and Exercises</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../lectures/take-seat.html">Take a Seat</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../get-started/software.html">Software Resources</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../get-started/vm.html">Virtual Machines and Linux</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../get-started/ide.html">Integrated Development Environments (IDEs)</a></li>



<li class="toctree-l2"><a class="reference internal" href="../../python-basics/pyinstall.html">Python (Installation)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../get-started/git.html">Version Control : git</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../get-started/geo.html">Geospatial Software</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../get-started/install-openfoam.html">OpenFOAM (Installation)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../get-started/install-telemac.html">TELEMAC (Installation)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../get-started/others.html">Other Software Resources</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Python Basics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../python-basics/python.html">First Steps</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../jupyter/pybase.html">Hello Data Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../jupyter/pyerror.html">Errors, Logging, and Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../jupyter/pyloop.html">Loops and Conditional Statements</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../python-basics/modularize.html">Object Orientation</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../jupyter/pyfun.html">Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../jupyter/pypckg.html">Packages, Modules and Libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../jupyter/classes.html">Object Orientation and Classes</a></li>

</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../python-basics/data-handling.html">Data and File Handling</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../jupyter/pynum.html">Data Files, NumPy &amp; Pandas</a></li>





<li class="toctree-l2"><a class="reference internal" href="../../jupyter/xml.html">Structured Data (XML, xlsx &amp; JSON)</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../jupyter/pyplot.html">Plotting</a></li>

</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../jupyter/pystyle.html">Code Style and Conventions</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../jupyter/gui.html">Graphical User Interfaces (GUIs)</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../exercises/python-exercises.html">Python Exercises</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../exercises/ex-ms.html">1d Hydraulics (Manning-Strickler Formula)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../exercises/ex-sp.html">Reservoir Volume (Sequent Peak Algorithm)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../exercises/ex-floods.html">Flood Return Periods</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../exercises/ex-sediment.html">1d Sediment Transport</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../exercises/ex-gui.html">Create a GUI</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Geospatial Analysis</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../geopy/geospatial-data.html">Geospatial Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../geopy/use-qgis.html">QGIS Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../geopy/drone-processing.html">Process Drone (UAV) Imagery</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../geopy/geo-python.html">Geospatial Python</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../geopy/geo-pckg.html">Geospatial Open Source Python Libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../jupyter/geo-shp.html">Shapefile (Vector) Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../jupyter/geo-raster.html">Raster (Grid) Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../jupyter/geo-convert.html">Vectorize and Rasterize</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../jupyter/geo-arcpy.html">The Commercial arcpy Library</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../exercises/geo-exercises.html">Exercises</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../exercises/ex-geco.html">Script a Habitat Suitability Map</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Numerical Modeling</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../numerical-modeling.html">Principles</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../basement/basement.html">BASEMENT</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../pre-qgis-bm.html">Pre-processing with QGIS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basement/basement2d.html">Run and Check a Steady 2d Simulation</a></li>



</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="telemac.html">TELEMAC</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../pre-slf-tm.html">Pre-processing</a></li>


<li class="toctree-l2 has-children"><a class="reference internal" href="telemac2d.html">Telemac2d</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-11"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="telemac2d-steady.html">Steady 2d</a></li>



<li class="toctree-l3"><a class="reference internal" href="telemac2d-unsteady.html">Unsteady 2d</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="telemac3d.html">Telemac3d</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-12"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="telemac3d-slf.html">Steady 3d (SLF - Selafin)</a></li>
<li class="toctree-l3"><a class="reference internal" href="telemac3d-med.html">Steady 3d (MED and Salome)</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="telemac-gaia.html">Gaia (Morphodynamics)</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-13"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="gaia-coupling.html">Introduction and Coupling</a></li>
<li class="toctree-l3"><a class="reference internal" href="gaia-basics.html">Basic Setup of Gaia</a></li>
<li class="toctree-l3"><a class="reference internal" href="gaia-bedload.html">Bedload</a></li>
<li class="toctree-l3"><a class="reference internal" href="gaia-suspended.html">Suspended Load</a></li>
<li class="toctree-l3"><a class="reference internal" href="gaia-run.html">Run and Analyze</a></li>
</ul>
</li>
<li class="toctree-l2 current active has-children"><a class="reference internal" href="mass-balance-bc.html">Boundaries &amp; Mass Convergence</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-14"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="boundaries.html">Boundary Conditions</a></li>
<li class="toctree-l3 current active"><a class="current reference internal" href="#">Convergence (Quantitative)</a></li>
<li class="toctree-l3"><a class="reference internal" href="mass-optimization.html">Mass Conservation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="roughness.html">Friction (Roughness) Zones</a></li>




<li class="toctree-l2"><a class="reference internal" href="optimization.html">Optimization</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../openfoam/of-intro.html">OpenFOAM</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-15"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../openfoam/of-tutorial-multiphase.html">Multiphase Solver (interFoam Tutorial)</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-16"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../openfoam/of-tutorial-multiphase-mesh.html">Geometry and Mesh Generation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../openfoam/of-tutorial-multiphase-setup.html">Case set-up</a></li>




<li class="toctree-l3"><a class="reference internal" href="../openfoam/of-tutorial-multiphase-run.html">Run OpenFOAM</a></li>
<li class="toctree-l3"><a class="reference internal" href="../openfoam/of-tutorial-multiphase-post.html">Post-processing</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Machine Learning (ML)</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../datascience/machinelearning.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../datascience/dimensional-analysis.html">About Data Analysis</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../datascience/supervised-learning.html">Supervised Learning</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-17"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../datascience/linear-models.html">Linear Models</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-18"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../datascience/linear-classification.html">Linear Classification</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../datascience/linear-regression.html">Linear Regression</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../datascience/non-linear-models.html">Non-linear models</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-19"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../datascience/kernelized-supervised-models.html">Kernels</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../datascience/morphology-predictor-svm.html">Support Vector Machine (SVM)</a></li>


<li class="toctree-l3"><a class="reference internal" href="../../datascience/three-based-methods.html">Three-based methods (Coming soon)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../datascience/neural-networks.html">Neural Networks (Supervised)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../datascience/unsupervised-learning.html">Unsupervised Learning (Coming soon)</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Documentation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../documentation/how-to-document.html">How to Markdown and Document</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/notation.html">Notation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/bibliography.html">References</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../exercises/docs-exercises.html">Exercises</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-20"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../exercises/ex-git.html">Git and Markdown</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Troubleshoot</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../troubleshoot/dbg-programming.html">Programming Tools and IDEs</a><input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-21"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../troubleshoot/dbg-anaconda.html">Debugging Anaconda</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../troubleshoot/dbg-python.html">Debugging Python Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../troubleshoot/dbg-jupyter.html">Debugging Jupyter</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../troubleshoot/dbg-numerical-models.html">Numerical Models</a><input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-22"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../troubleshoot/dbg-basement.html">Debugging BASEMENT</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../troubleshoot/dbg-telemac.html">Debugging TELEMAC</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../troubleshoot/dbg-os.html">Operating Systems (Linux and VMs)</a><input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-23"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../troubleshoot/dbg-linux.html">Debugging Debian Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../troubleshoot/dbg-vm.html">Debugging Virtual Machines</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../troubleshoot/dbg-scilife.html">Science Life Hacks</a><input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-24"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../troubleshoot/dbg-gis.html">GIS, CRS and Projections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../troubleshoot/dbg-zotero.html">Zotero Utilities</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">About</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../terms/license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../terms/disclaimer.html">Disclaimer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/contributors.html">Contributors</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/hydro-informatics/jupyter-python-course" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/numerics/telemac/convergence.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Convergence (Quantitative)</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#extract-and-check-flux-data">Extract and Check Flux Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tm-calculate-convergence">Identify Convergence</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#derive-optimum-simulation-time">Derive Optimum Simulation Time</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#troubleshoot-instabilities-divergence">Troubleshoot Instabilities &amp; Divergence</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="convergence-quantitative">
<span id="tm-convergence"></span><h1>Convergence (Quantitative)<a class="headerlink" href="#convergence-quantitative" title="Permalink to this headline">#</a></h1>
<div class="important dropdown admonition">
<p class="admonition-title">Requirements</p>
<ul class="simple">
<li><p>Complete the <a class="reference internal" href="telemac2d-steady.html#telemac2d-steady"><span class="std std-ref">Telemac steady 2d tutorial</span></a> (or similar).</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">MASS-BALANCE</span> <span class="pre">:</span> <span class="pre">YES</span></code> and/or <code class="docutils literal notranslate"><span class="pre">PRINTING</span> <span class="pre">CUMULATED</span> <span class="pre">FLOWRATES</span> <span class="pre">:</span> <span class="pre">YES</span></code>  keywords must have been used in the steering (<code class="docutils literal notranslate"><span class="pre">.cas</span></code>) file to print mass fluxes across liquid boundaries in the Terminal.</p></li>
<li><p>The Telemac simulation must have been running with the <code class="docutils literal notranslate"><span class="pre">s</span></code> flag (more details below):</p></li>
</ul>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="n">telemac2d</span><span class="p">.</span><span class="n">py</span><span class="w"> </span><span class="p">[</span><span class="n">STUDY</span><span class="o">-</span><span class="n">NAME</span><span class="p">].</span><span class="n">cas</span><span class="w"> </span><span class="o">-</span><span class="n">s</span>
</pre></div>
</div>
<ul class="simple">
<li><p>An installation of Python along with the <code class="docutils literal notranslate"><span class="pre">numpy</span></code>, <code class="docutils literal notranslate"><span class="pre">pandas</span></code>, and <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> libraries (<a class="reference internal" href="../../python-basics/pyinstall.html#install-python"><span class="std std-ref">see the Python installation guide</span></a>), even though <code class="docutils literal notranslate"><span class="pre">flusstools</span></code> is not required).</p></li>
</ul>
<p><strong>All required simulation files for this tutorial can be downloaded from the <a class="reference external" href="https://github.com/hydro-informatics/telemac/tree/main/steady2d-tutorial">hydro-informatics/telemac repository on GitHub</a> (see details below).</strong></p>
</div>
<div class="note admonition">
<p class="admonition-title">Goals &amp; purpose</p>
<p>This tutorial describes the verification of flux convergence to optimize the required number of simulation timesteps (<code class="docutils literal notranslate"><span class="pre">NUMBER</span> <span class="pre">OF</span> <span class="pre">TIME</span> <span class="pre">STEPS</span></code>) of a <strong>steady</strong> Telemac simulation. Such convergence analysis is recommended before using steady simulation results for hotstarting an <a class="reference internal" href="telemac2d-unsteady.html#chpt-unsteady"><span class="std std-ref">unsteady</span></a> or a <a class="reference internal" href="gaia-basics.html#gaia-basics"><span class="std std-ref">morphodynamic (sediment transport)</span></a> simulation. However, the here-shown scripts can also serve for comparison of travel times of flood waves traveling from an upstream to a downstream boundary.</p>
<p>If you are looking for solutions to fix a non-converging model, please refer to the <a class="reference internal" href="mass-optimization.html#tm-foc-mass"><span class="std std-ref">spotlight chapter on mass conservation</span></a> and make sure the <a class="reference internal" href="boundaries.html#tm-foc-bc"><span class="std std-ref">liquid boundaries are well defined</span></a>.</p>
</div>
<p>This chapter uses the simulation files from the <a class="reference internal" href="telemac2d-steady.html#telemac2d-steady"><span class="std std-ref">Telemac steady 2d tutorial</span></a>, but with a slightly different definition of timesteps and printout periods:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="w"> </span><span class="n">steady2d</span><span class="o">-</span><span class="n">conv</span><span class="p">.</span><span class="n">cas</span>
<span class="nb">TIME </span><span class="n">STEP</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">1.</span>
<span class="n">NUMBER</span><span class="w"> </span><span class="n">OF</span><span class="w"> </span><span class="nb">TIME </span><span class="n">STEPS</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10000</span>
<span class="n">GRAPHIC</span><span class="w"> </span><span class="n">PRINTOUT</span><span class="w"> </span><span class="n">PERIOD</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">50</span>
<span class="n">LISTING</span><span class="w"> </span><span class="n">PRINTOUT</span><span class="w"> </span><span class="n">PERIOD</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">50</span>
</pre></div>
</div>
<p>Additionally, the simulation was rerun with the <code class="docutils literal notranslate"><span class="pre">-s</span></code> flag, which saves the simulation state in a file called similar to <code class="docutils literal notranslate"><span class="pre">[FILE-NAME].cas_YEAR-MM-DD-HHhMMminSSs.sortie</span></code>.</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="n">telemac2d</span><span class="p">.</span><span class="n">py</span><span class="w"> </span><span class="n">steady2d</span><span class="o">-</span><span class="n">conv</span><span class="p">.</span><span class="n">cas</span><span class="w"> </span><span class="o">-</span><span class="n">s</span>
</pre></div>
</div>
<p>Both the steering <code class="docutils literal notranslate"><span class="pre">.cas</span></code> and <code class="docutils literal notranslate"><span class="pre">.sortie</span></code> files can be downloaded from the <a class="reference external" href="http://hydro-informatics.com">hydro-informatics.com</a> repositories:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/hydro-informatics/telemac/raw/main/steady2d-tutorial/steady2d-conv.cas">download steady2d-conv.cas</a></p></li>
<li><p><a class="reference external" href="https://github.com/hydro-informatics/telemac/raw/main/steady2d-tutorial/steady2d-conv.cas_2023-07-26-18h41min26s.sortie">download steady2d-conv.cas_2023-07-26-18h41min26s.sortie</a></p></li>
</ul>
<section id="extract-and-check-flux-data">
<span id="tm-flux-convergence"></span><h2>Extract and Check Flux Data<a class="headerlink" href="#extract-and-check-flux-data" title="Permalink to this headline">#</a></h2>
<div class="admonition-alternative-use-control-sections admonition">
<p class="admonition-title">Alternative: use control sections</p>
<p>This section features flux (flow) convergence analysis directly from Telemac message logging with Python. Alternatively, fluxes can be extracted by <a class="reference internal" href="telemac2d-unsteady.html#tm-control-sections"><span class="std std-ref">defining control sections (read more in the unsteady tutorial</span></a>.</p>
</div>
<p>The Telemac jupyter notebook templates (<em>HOMETEL/notebooks/</em> &gt; <em>data_manip/extraction/*.ipynb</em> or <em>workshops/exo_fluxes.ipynb</em>) provide some guidance for extracting data from simulation results, which can be tweaked into a generally applicable framework for observing mass convergence at the boundaries as a function of the defined <code class="docutils literal notranslate"><span class="pre">NUMBER</span> <span class="pre">OF</span> <span class="pre">TIME</span> <span class="pre">STEPS</span></code>. However, the notebook templates do not work straightforwardly, which is why the following paragraphs describe a simple, minimalist Python tweak called <a class="reference external" href="https://pythomac.readthedocs.io">pythomac</a>, developed by <a class="reference external" href="http://hydro-informatics.com">hydro-informatics.com</a>. There are three options for working with our codes, and all of them require having an installation of Python along with the <code class="docutils literal notranslate"><span class="pre">numpy</span></code>, <code class="docutils literal notranslate"><span class="pre">pandas</span></code>, and <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> libraries (<a class="reference internal" href="../../python-basics/pyinstall.html#install-python"><span class="std std-ref">see the Python installation guide</span></a>):</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-0" name="sd-tab-set-0" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-0">
pip-install pythomac</label><div class="sd-tab-content docutils">
<p>Pip-install the <em>pythomac</em> package:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">pythomac</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-1" name="sd-tab-set-0" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-1">
clone pythomac</label><div class="sd-tab-content docutils">
<p>Clone the <em>pythomac</em> repository from <a class="reference external" href="https://github.com/hydro-informatics/pythomac">GitHub</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">hydro</span><span class="o">-</span><span class="n">informatics</span><span class="o">/</span><span class="n">pythomac</span><span class="o">.</span><span class="n">git</span>
</pre></div>
</div>
<p>Copy-paste the folder <code class="docutils literal notranslate"><span class="pre">pythomac/pythomac/</span></code> into your simulation directory. That is, make sure that the Python script <code class="docutils literal notranslate"><span class="pre">/HOME/pythomac/extract_fluxes.py</span></code> (among others) is correctly located, next to <code class="docutils literal notranslate"><span class="pre">/HOME/your-simulation-dir/steady2d.cas</span></code>.</p>
</div>
<input id="sd-tab-item-2" name="sd-tab-set-0" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-2">
download pythomac as zip</label><div class="sd-tab-content docutils">
<p>Download a zipped archive of the <em>pythomac</em> repository from <a class="reference external" href="https://github.com/hydro-informatics/pythomac/archive/refs/heads/main.zip">GitHub (right-click here &gt; save as…)</a>. Open the zip archive &gt; open <code class="docutils literal notranslate"><span class="pre">pythomac-main</span></code>, and extract the contents of the <code class="docutils literal notranslate"><span class="pre">pythomac</span></code> folder (i.e., <code class="docutils literal notranslate"><span class="pre">pythomac-main/pythomac/</span></code>) next to your simulation directory. That is, make sure that the Python script <code class="docutils literal notranslate"><span class="pre">/HOME/pythomac/extract_fluxes.py</span></code> (among others) is correctly located, next to <code class="docutils literal notranslate"><span class="pre">/HOME/your-simulation-dir/steady2d.cas</span></code>.</p>
</div>
</div>
<div class="tip dropdown admonition" id="python-extract-fluxes-telemac">
<p class="admonition-title">Expand to see the code in the extract_fluxes.py Python script:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot; Extract data from a Telemac simulation that has already been running.</span>
<span class="sd">The codes are inspired by the following jupyter notebook:</span>
<span class="sd">    HOMETEL/notebooks/data_manip/extraction/output_file_extraction.ipynb</span>
<span class="sd"> which uses the following example case:</span>
<span class="sd">    /examples/telemac2d/bump/t2d_bump_FE.cas</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># retrieve file paths - this script must be stored in the directory where the simulation lives</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="c1"># data processing</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="c1"># plotting</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)))</span>
<span class="c1"># Telemac stuff</span>
<span class="kn">from</span> <span class="nn">parser_output</span> <span class="kn">import</span> <span class="n">get_latest_output_files</span>
<span class="kn">from</span> <span class="nn">parser_output</span> <span class="kn">import</span> <span class="n">OutputFileData</span>


<span class="k">def</span> <span class="nf">extract_fluxes</span><span class="p">(</span>
        <span class="n">model_directory</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">cas_name</span><span class="o">=</span><span class="s2">&quot;steady2d.cas&quot;</span><span class="p">,</span>
        <span class="n">plotting</span><span class="o">=</span><span class="kc">True</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This function writes a .csv file and an x-y plot of fluxes across the boundaries of a Telemac2d model. It auto-</span>
<span class="sd">        matically place the .csv and .png plot files into the simulation directory (i.e., where the .cas file is).</span>

<span class="sd">    Notes:</span>
<span class="sd">        * The Telemac simulation must have been running with the &#39;-s&#39; flag (``telemac2d.py my.cas -s``).</span>
<span class="sd">        * Make sure to activate the .cas keyword ``PRINTING CUMULATED FLOWRATES : YES``</span>
<span class="sd">        * This script skips volume errors (search tags are not implemented).</span>
<span class="sd">        * Read more about this script at</span>
<span class="sd">            https://hydro-informatics.com/numerics/telemac/telemac2d-steady.html#verify-steady-tm2d</span>

<span class="sd">    :param str model_directory: the file directory where the simulation lives</span>
<span class="sd">    :param str cas_name: name of the .cas steering file (without directory)</span>
<span class="sd">    :param bool plotting: default (True) will place a figure called flux-convergence.png in the simulation directory</span>
<span class="sd">    :return pandas.DataFrame: time series of fluxes across boundaries (if Error int: -1)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># assign cas file name in the folder</span>
    <span class="n">file_name</span> <span class="o">=</span> <span class="n">get_latest_output_files</span><span class="p">(</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_directory</span><span class="p">,</span>  <span class="c1"># os.path.dirname(os.path.realpath(__file__))</span>
                     <span class="n">cas_name</span>
                     <span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># go to working directory</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">model_directory</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">problem</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: the provided directory </span><span class="si">{0}</span><span class="s2"> does not exist:</span><span class="se">\n</span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">model_directory</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">problem</span><span class="p">)))</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">out_file</span> <span class="o">=</span> <span class="n">OutputFileData</span><span class="p">(</span><span class="n">file_name</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CAS name: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span> <span class="n">cas_name</span><span class="p">)))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR in file </span><span class="si">{0}</span><span class="s2">:</span><span class="se">\n</span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">file_name</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Recall: the simulation must run with the -s flags&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Found study with name: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">out_file</span><span class="o">.</span><span class="n">get_name_of_study</span><span class="p">()))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The simulation took: </span><span class="si">{}</span><span class="s2"> seconds&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">out_file</span><span class="o">.</span><span class="n">get_exec_time</span><span class="p">()))</span>

    <span class="c1"># extract total volume, fluxes, and volume error</span>
    <span class="n">out_fluxes</span> <span class="o">=</span> <span class="n">out_file</span><span class="o">.</span><span class="n">get_value_history_output</span><span class="p">(</span><span class="s2">&quot;voltotal;volfluxes;volerror&quot;</span><span class="p">)</span>
    <span class="n">out_fluxes_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">out_fluxes</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># differentiate between Time and Flux series with nested lists</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="n">out_fluxes_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">])})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">sub_e</span> <span class="ow">in</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">if</span> <span class="s2">&quot;volume&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">sub_e</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                            <span class="c1"># go here if (&#39;Volumes (m3/s)&#39;, [volume(t)])</span>
                            <span class="n">out_fluxes_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">sub_e</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sub_e</span><span class="p">[</span><span class="mi">1</span><span class="p">])})</span>
                        <span class="k">if</span> <span class="s2">&quot;fluxes&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">sub_e</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                            <span class="k">for</span> <span class="n">bound_i</span><span class="p">,</span> <span class="n">bound_e</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sub_e</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                                <span class="n">out_fluxes_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
                                    <span class="s2">&quot;Fluxes </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">bound_e</span><span class="p">)):</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sub_e</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">bound_i</span><span class="p">])</span>
                                <span class="p">})</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">problem</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR in intended VOLUME tuple &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sub_e</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">problem</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">problem</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR in &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">problem</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: Flux series seem empty. Verify:&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;         - did you run telemac2d.py sim.cas with the -s flag?&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;         - did your define all required VARIABLES FOR GRAPHIC PRINTOUTS (U,V,S,B,Q,F,H)?&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">out_fluxes_dict</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">problem</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: could not convert dict to DataFrame because:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">problem</span><span class="p">))</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

    <span class="n">export_fn</span> <span class="o">=</span> <span class="s2">&quot;extracted_fluxes.csv&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;* Exporting to </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_directory</span><span class="p">,</span> <span class="n">export_fn</span><span class="p">))))</span>
    <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_directory</span><span class="p">,</span> <span class="n">export_fn</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">plotting</span><span class="p">:</span>
        <span class="n">font</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">}</span>
        <span class="n">matplotlib</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">font</span><span class="p">)</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">()</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)))</span>
        <span class="n">markers</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;CARETDOWN&quot;</span><span class="p">,</span> <span class="s2">&quot;3&quot;</span><span class="p">,</span> <span class="s2">&quot;^&quot;</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="p">)):</span>
            <span class="k">if</span> <span class="s2">&quot;flux&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="n">y</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">markers</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
                          <span class="n">markeredgecolor</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">)))</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time (s)&quot;</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Fluxes (m$^3$/s)&quot;</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">framealpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_directory</span><span class="p">,</span> <span class="s2">&quot;flux-convergence.png&quot;</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;* Saved plot as &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_directory</span><span class="p">,</span> <span class="s2">&quot;flux-convergence.png&quot;</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">df</span>
</pre></div>
</div>
</div>
<p>Detailed instructions for using the <code class="docutils literal notranslate"><span class="pre">extract_fluxes()</span></code> function through pythomac and its dependencies (<code class="docutils literal notranslate"><span class="pre">numpy</span></code>, <code class="docutils literal notranslate"><span class="pre">pandas</span></code>, and <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code>) can be found at <a class="reference external" href="https://pythomac.readthedocs.io">https://pythomac.readthedocs.io</a>.</p>
<p>To use the functions defined in <code class="docutils literal notranslate"><span class="pre">pythomac</span></code>, copy the following code into a new Python script called, for instance, <code class="docutils literal notranslate"><span class="pre">example_flux_convergence.py</span></code> in the directory where the dry-initialized steady2d simulation ran (or <a class="reference external" href="https://github.com/hydro-informatics/pythomac/blob/main/example_flux_convergence.py">download example_flux_convergence.py</a>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># example_flux_convergence.py</span>

<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">pythomac</span> <span class="kn">import</span> <span class="n">extract_fluxes</span>

<span class="n">simulation_dir</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">telemac_cas</span> <span class="o">=</span> <span class="s2">&quot;steady2d.cas&quot;</span>

<span class="n">fluxes_df</span> <span class="o">=</span> <span class="n">extract_fluxes</span><span class="p">(</span>
    <span class="n">model_directory</span><span class="o">=</span><span class="n">simulation_dir</span><span class="p">,</span>
    <span class="n">cas_name</span><span class="o">=</span><span class="n">telemac_cas</span><span class="p">,</span>
    <span class="n">plotting</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="error admonition">
<p class="admonition-title">Got errors? Verify that the simulation directories are correct.</p>
<p>Adding a simple <code class="docutils literal notranslate"><span class="pre">print(simulation_dir)</span></code> line in the above code block might help to check the correctness of directories. That is, the Python code should be able to fine the simulation.</p>
</div>
<p>Run the Python script from Terminal (or Anaconda Prompt) as follows (make sure to <code class="docutils literal notranslate"><span class="pre">cd</span></code> into the simulation directory):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">example_flux_convergence</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>The script will have placed in the simulation folder:</p>
<ul class="simple">
<li><p>a CSV file called <a class="reference external" href="https://github.com/hydro-informatics/telemac/raw/main/steady2d-tutorial/extracted_fluxes.csv">extracted_fluxes.csv (download)</a>, and</p></li>
<li><p>a plot of flux convergences (<em>flux-convergence.png</em>) across the model boundaries (see <a class="reference internal" href="#steady-flux-convergence"><span class="std std-numref">Fig. 198</span></a>) showing qualitatively that the fluxes reached convergence after approximately 6000-7000 timesteps.</p></li>
</ul>
<figure class="align-default" id="steady-flux-convergence">
<img alt="python telemac flux discharge convergence pythomac" src="../../_images/flux-convergence.png" />
<figcaption>
<p><span class="caption-number">Fig. 198 </span><span class="caption-text">Flux convergence plot across the two boundaries of the dry-initialized steady Telemac2d simulation with a total simulation time of timesteps seconds, created with the pythomac.extract_fluxes() function.</span><a class="headerlink" href="#steady-flux-convergence" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="tm-calculate-convergence">
<span id="identify-convergence"></span><h2>Identify Convergence<a class="headerlink" href="#tm-calculate-convergence" title="Permalink to this headline">#</a></h2>
<p>To test if and when the fluxes converged, we can calculate the differences between fluxes for every timestep <span class="math notranslate nohighlight">\(t\)</span> as:</p>
<div class="math notranslate nohighlight" id="equation-error-rate">
<span class="eqno">(18)<a class="headerlink" href="#equation-error-rate" title="Permalink to this equation">#</a></span>\[\varepsilon_{t} = |Q_i,t - Q_j,t|\]</div>
<p>where <span class="math notranslate nohighlight">\(Q_i,t\)</span> and <span class="math notranslate nohighlight">\(Q_j,t\)</span> are the sum of the outflow and inflow fluxes across the model boundaries at timestep <span class="math notranslate nohighlight">\(t\)</span>, respectively. In a stable steady simulation, the ratio of inflows and outflows should converge toward a convergence constant c_{\varepsilon} equal to unity with increasing time:</p>
<div class="math notranslate nohighlight" id="equation-error-lim">
<span class="eqno">(19)<a class="headerlink" href="#equation-error-lim" title="Permalink to this equation">#</a></span>\[\lim_{t\to \infty} \frac{\varepsilon_{t+1}}{\varepsilon^{\iota}_{t}} = c_{\varepsilon}\]</div>
<p>The combination of the convergence rate (or order) <span class="math notranslate nohighlight">\(\iota\)</span>, and the convergence constant <span class="math notranslate nohighlight">\(c_{\varepsilon}\)</span> indicate:</p>
<ul class="simple">
<li><p>linear convergence if <span class="math notranslate nohighlight">\(\iota\)</span> = 1 <strong>and</strong> <span class="math notranslate nohighlight">\(c_{\varepsilon} \in ]0, 1[\)</span></p></li>
<li><p>slow <em>sublinear</em> convergence if <span class="math notranslate nohighlight">\(\iota\)</span> = 1 <strong>and</strong> <span class="math notranslate nohighlight">\(c_{\varepsilon}\)</span> = 1</p></li>
<li><p>fast <em>superlinear</em> convergence if <span class="math notranslate nohighlight">\(\iota\)</span> &gt; 1 <strong>and</strong> <span class="math notranslate nohighlight">\(c_{\varepsilon} \in ]0, 1]\)</span></p></li>
<li><p>divergence convergence if <span class="math notranslate nohighlight">\(\iota\)</span> = 1 <strong>and</strong> <span class="math notranslate nohighlight">\(c_{\varepsilon}\)</span> &gt; 1; <strong>or</strong> <span class="math notranslate nohighlight">\(\iota\)</span> &lt; 1</p></li>
</ul>
<aside class="margin sidebar">
<p class="sidebar-title">Calculate <span class="math notranslate nohighlight">\(\varepsilon_{t+1}\)</span></p>
<p>To calculate <span class="math notranslate nohighlight">\(\varepsilon_{t+1}\)</span> (<code class="docutils literal notranslate"><span class="pre">epsilon_t1</span></code>) from <span class="math notranslate nohighlight">\(\varepsilon_{t}\)</span> (<code class="docutils literal notranslate"><span class="pre">epsilon_t0</span></code>), we simply roll <span class="math notranslate nohighlight">\(\varepsilon_{t}\)</span> by one element in Python:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">epsilon_t0</span> <span class="o">=</span> <span class="n">epsilon</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># cut off last element</span>
<span class="n">epsilon_t1</span> <span class="o">=</span> <span class="n">epsilon</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>   <span class="c1"># cut off element zero</span>
</pre></div>
</div>
</aside>
<p>To determine the timestep at which a steady simulation can be considered to have reached a stable state, we want to observe when <span class="math notranslate nohighlight">\(\iota\)</span> = 1 and <span class="math notranslate nohighlight">\(c_{\varepsilon}\)</span> = 1 indicate sublinear convergence. That is, we look for the timestep <span class="math notranslate nohighlight">\(t\)</span> above which each additional timestep <span class="math notranslate nohighlight">\(t+1\)</span> only insignificantly improves the model precision (read more on the term <em>insignificant</em> in the <a class="reference internal" href="#tm-target-conv"><span class="std std-ref">below section</span></a>). Thus, assuming that the model convergences in any form, we can set <span class="math notranslate nohighlight">\(c_{\varepsilon}\)</span> = 1 to compute <span class="math notranslate nohighlight">\(\iota (t)\)</span> as a function of <span class="math notranslate nohighlight">\(\varepsilon_{t}\)</span> and <span class="math notranslate nohighlight">\(\varepsilon_{t+1}\)</span>:</p>
<div class="amsmath math notranslate nohighlight" id="equation-e744d023-d5af-4ad3-a146-31bd25e110b8">
<span class="eqno">(20)<a class="headerlink" href="#equation-e744d023-d5af-4ad3-a146-31bd25e110b8" title="Permalink to this equation">#</a></span>\[\begin{align}
\label{estimate_convergence}
\frac{\varepsilon_{t+1}}{\varepsilon^{\iota(t)}_{t}} &amp;=c_{\varepsilon} &amp; \Leftrightarrow \\
\iota(t) &amp;=  \frac{1}{c_{\varepsilon}} \cdot \log_{\varepsilon_{t}\varepsilon_{t+1}} &amp; \overbrace{\Longleftrightarrow }^{c_{\varepsilon} = 1}\\
\iota(t) &amp;=  \log_{\varepsilon_{t}\varepsilon_{t+1}} &amp;
\end{align}\]</div>
<p>This equation can be implemented in a function Python as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>


<span class="k">def</span> <span class="nf">calculate_convergence</span><span class="p">(</span><span class="n">Q_in</span><span class="p">,</span> <span class="n">Q_out</span><span class="p">,</span> <span class="n">conv_constant</span><span class="o">=</span><span class="mf">1.</span><span class="p">):</span>
    <span class="c1"># calculate the error epsilon between two flux series</span>
    <span class="n">epsilon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">Q_in</span> <span class="o">-</span> <span class="n">Q_out</span><span class="p">))</span>
    <span class="c1"># derive epsilon at t and t+1</span>
    <span class="n">epsilon_t0</span> <span class="o">=</span> <span class="n">epsilon</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># cut off last element</span>
    <span class="n">epsilon_t1</span> <span class="o">=</span> <span class="n">epsilon</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>   <span class="c1"># cut off element zero</span>
    <span class="c1"># return convergence rate as pandas DataFrame</span>
    <span class="k">return</span>  <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Convergence rate&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">emath</span><span class="o">.</span><span class="n">logn</span><span class="p">(</span><span class="n">epsilon_t0</span><span class="p">,</span> <span class="n">epsilon_t1</span><span class="p">)</span> <span class="o">/</span> <span class="n">conv_constant</span> <span class="p">})</span>
</pre></div>
</div>
<div class="tip admonition">
<p class="admonition-title">Also this function is available in pythomac</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pythomac</span> <span class="kn">import</span> <span class="n">calculate_convergence</span>
</pre></div>
</div>
</div>
<p>To calculate <span class="math notranslate nohighlight">\(\iota (t)\)</span> (Python variable name: <code class="docutils literal notranslate"><span class="pre">iota_t</span></code>) with the above function, amend the <em>example_flux_convergence.py</em> Python script:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># example_flux_convergence.py</span>

<span class="c1"># ...</span>
<span class="c1"># add to header (alternatively copy-paste the above function into this script):</span>
<span class="kn">from</span> <span class="nn">pythomac</span> <span class="kn">import</span> <span class="n">calculate_convergence</span>

<span class="c1"># calculate fluxes_df (see above code block)</span>
<span class="n">fluxes_df</span> <span class="o">=</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span>

<span class="c1"># calculate iota (t) with the calculate_convergence function</span>
<span class="n">iota_t</span> <span class="o">=</span> <span class="n">calculate_convergence</span><span class="p">(</span>
    <span class="n">fluxes_df</span><span class="p">[</span><span class="s2">&quot;Fluxes Boundary 1&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">:],</span>  <span class="c1"># remove first zero-entry</span>
    <span class="n">fluxes_df</span><span class="p">[</span><span class="s2">&quot;Fluxes Boundary 2&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">:],</span>  <span class="c1"># remove first zero-entry</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The resulting convergence rate <span class="math notranslate nohighlight">\(\iota (t)\)</span> is plotted in <a class="reference internal" href="#tm-convergence-rate"><span class="std std-numref">Fig. 199</span></a> for the <a class="reference internal" href="telemac2d-steady.html#telemac2d-steady"><span class="std std-ref">steady 2d tutorial</span></a>, with the modified printout periods of <code class="docutils literal notranslate"><span class="pre">50</span></code> seconds and a total simulation time of <code class="docutils literal notranslate"><span class="pre">10000</span></code> seconds.</p>
<figure class="align-default" id="tm-convergence-rate">
<img alt="convergence rate fluxes telemac boundaries" src="../../_images/convergence-rate.png" />
<figcaption>
<p><span class="caption-number">Fig. 199 </span><span class="caption-text">The convergence rate <span class="math notranslate nohighlight">\(\iota\)</span> as a function 10000 simulation timesteps of the steady 2d simulation.</span><a class="headerlink" href="#tm-convergence-rate" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="derive-optimum-simulation-time">
<span id="tm-target-conv"></span><h2>Derive Optimum Simulation Time<a class="headerlink" href="#derive-optimum-simulation-time" title="Permalink to this headline">#</a></h2>
<p>To save computing time, we are interested in the timestep at which the inflow and outflow fluxes converged. The fluxes plotted in <a class="reference internal" href="#steady-flux-convergence"><span class="std std-numref">Fig. 198</span></a>, and the convergence rate in <a class="reference internal" href="#tm-convergence-rate"><span class="std std-numref">Fig. 199</span></a> qualitatively suggest that the simulation was stable after approximately 6000 seconds (timesteps). The bumps in both figures after 4000 timesteps well indicate the “encounter” of the flux “waves” coming from the upstream and downstream boundaries (see the <a class="reference internal" href="telemac2d-steady.html#telemac-flow-convergence-gif"><span class="std std-ref">animation in the steady 2d tutorial</span></a>). Only afterward, did convergence set in.</p>
<p>The definition of when convergence is reached (i.e., <span class="math notranslate nohighlight">\(\iota\)</span> being insignificant) can be subjective. Most modelers would agree that fluctuations of the convergence rate <span class="math notranslate nohighlight">\(\iota\)</span> of more than 0.1 to 0.01 are unacceptably high, but, depending on the problem considered, <span class="math notranslate nohighlight">\(\iota\)</span>-fluctuations in the order of 10<span class="math notranslate nohighlight">\(^{-4}\)</span> to 10<span class="math notranslate nohighlight">\(^{-12}\)</span> might be considered acceptable. To investigate at which simulation timestep a target convergence rate <span class="math notranslate nohighlight">\(\iota_{tar}\)</span> was achieved, we can analyze the vector of <span class="math notranslate nohighlight">\(\iota (t)\)</span> resulting from the above Equation. Specifically, we want to know after which timestep <span class="math notranslate nohighlight">\(t\)</span> the targeted convergence fluctuation <span class="math notranslate nohighlight">\(\delta\iota_{tar}\)</span> is not exceeded anymore. Note that <span class="math notranslate nohighlight">\(\delta\iota (t)\)</span> plotted in <a class="reference internal" href="#tm-convergence-rate"><span class="std std-numref">Fig. 199</span></a> achieved a possibly desired target convergence rate of <span class="math notranslate nohighlight">\(\delta\iota_{tar}\)</span> = 10<span class="math notranslate nohighlight">\(^{-4}\)</span> already after approximately 3000 timesteps, but <span class="math notranslate nohighlight">\(\iota\)</span> jumped up again after 4000 timesteps when the upstream “wave” rolled over the downstream boundary. Therefore, we want an algorithmic implementation that detects the last <span class="math notranslate nohighlight">\(\iota_{t} - \iota_{t-1}\)</span> &gt; <span class="math notranslate nohighlight">\(\delta\iota_{tar}\)</span> in the vector of <span class="math notranslate nohighlight">\(\iota (t)\)</span>. To this end, we can add to the above-started <em>example_flux_convergence.py</em> Python script the following code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># example_flux_convergence.py</span>

<span class="c1"># ...</span>

<span class="c1"># calculate fluxes_df (see above code block)</span>
<span class="n">fluxes_df</span> <span class="o">=</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span>

<span class="c1"># calculate iota (t) with the calculate_convergence function</span>
<span class="n">iota_t</span> <span class="o">=</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span>

<span class="c1"># define a desired target convergence precision (delta iota_tar)</span>
<span class="n">target_convergence_precision</span> <span class="o">=</span> <span class="mf">1.0E-6</span>

<span class="c1"># calculate the differences in the convergence rates</span>
<span class="n">convergence_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">iota_t</span><span class="p">)</span>

<span class="c1"># find the index of the last element in the convergence differences that is larger than</span>
<span class="c1">#   the desired target convergence precision and add +1 (i.e., the first element being</span>
<span class="c1">#   permanently smaller than the desired precision)</span>
<span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flatnonzero</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">convergence_diff</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">target_convergence_precision</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>

<span class="c1"># print the timestep at which the desired convergence was achieve to the console</span>
<span class="n">printout_period_in_cas</span> <span class="o">=</span> <span class="mi">50</span>  <span class="c1"># the printout period defined in the cas file</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The simulation converged after </span><span class="si">{0}</span><span class="s2"> simulation seconds (</span><span class="si">{1}</span><span class="s2">th printout).&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">printout_period_in_cas</span> <span class="o">*</span> <span class="n">idx</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">)))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">The</span> <span class="n">simulation</span> <span class="n">converged</span> <span class="n">after</span> <span class="mi">8050</span> <span class="n">simulation</span> <span class="n">seconds</span> <span class="p">(</span><span class="mi">161</span><span class="n">th</span> <span class="n">printout</span><span class="p">)</span><span class="o">.</span>
</pre></div>
</div>
<div class="tip admonition">
<p class="admonition-title">Bolster your code</p>
<p>The code for calculating the timestep at which a target convergence level was achieved is also implemented in the <code class="docutils literal notranslate"><span class="pre">get_convergence_time()</span></code> function in <code class="docutils literal notranslate"><span class="pre">pythomac</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pythomac</span> <span class="kn">import</span> <span class="n">get_convergence_time</span>
</pre></div>
</div>
<p>A full implementation with also a convenient way for retrieving the <code class="docutils literal notranslate"><span class="pre">printout_period_in_cas</span></code> variable can be found in <a class="reference external" href="https://github.com/hydro-informatics/pythomac/blob/main/example_flux_convergence.py">this version of example_flux_convergence.py</a> with documentation on <a class="reference external" href="https://pythomac.readthedocs.io/en/latest/convergence.html">https://pythomac.readthedocs.io</a>.</p>
</div>
<p>Now that you know when your Telemac simulation converges satisfactorily, you can reduce the <code class="docutils literal notranslate"><span class="pre">NUMBER</span> <span class="pre">OF</span> <span class="pre">TIME</span> <span class="pre">STEPS</span></code> parameter in the <code class="docutils literal notranslate"><span class="pre">.cas</span></code> steering file, for example:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="w"> </span><span class="n">steady2d</span><span class="o">-</span><span class="n">conv</span><span class="p">.</span><span class="n">cas</span>
<span class="nb">TIME </span><span class="n">STEP</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">1.</span>
<span class="n">NUMBER</span><span class="w"> </span><span class="n">OF</span><span class="w"> </span><span class="nb">TIME </span><span class="n">STEPS</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">8050</span>
<span class="n">GRAPHIC</span><span class="w"> </span><span class="n">PRINTOUT</span><span class="w"> </span><span class="n">PERIOD</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">50</span>
<span class="n">LISTING</span><span class="w"> </span><span class="n">PRINTOUT</span><span class="w"> </span><span class="n">PERIOD</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">50</span>
</pre></div>
</div>
</section>
<section id="troubleshoot-instabilities-divergence">
<h2>Troubleshoot Instabilities &amp; Divergence<a class="headerlink" href="#troubleshoot-instabilities-divergence" title="Permalink to this headline">#</a></h2>
<p>If a steady simulation never reaches stability of fluxes or even flux divergence, make sure that all boundaries are robustly defined according to the spotlight section on <a class="reference internal" href="boundaries.html#tm-foc-bc"><span class="std std-ref">boundary conditions</span></a>, and have a look at the workflow in the next section on <a class="reference internal" href="mass-optimization.html#tm-foc-mass"><span class="std std-ref">mass conservation</span></a>.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "hydro-informatics/jupyter-python-course",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./numerics/telemac"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="boundaries.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Boundary Conditions</p>
      </div>
    </a>
    <a class="right-next"
       href="mass-optimization.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Mass Conservation</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#extract-and-check-flux-data">Extract and Check Flux Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tm-calculate-convergence">Identify Convergence</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#derive-optimum-simulation-time">Derive Optimum Simulation Time</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#troubleshoot-instabilities-divergence">Troubleshoot Instabilities &amp; Divergence</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Sebastian Schwindt, Beatriz Negreiros, Federica Scolari, Ricardo Barros
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>