
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Manipulation of Workbooks and JSON Files &#8212; Hydro-Informatics</title>
    
  <link rel="stylesheet" href="../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/tabs.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe,.cell"
        const thebe_selector_input = "pre,.cell_input div.highlight"
        const thebe_selector_output = ".output,.cell_output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://hydro-informatics.github.io/jupyter/xml.html" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Plotting" href="pyplot.html" />
    <link rel="prev" title="Load and Write Basic Data Files" href="pynum.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />


<!-- Opengraph tags -->
<meta property="og:url"         content="https://hydro-informatics.github.io/jupyter/xml.html" />
<meta property="og:type"        content="article" />
<meta property="og:title"       content="Manipulation of Workbooks and JSON Files" />
<meta property="og:description" content="Manipulation of Workbooks and JSON Files  Summary: Create, manipulate and copy xlsx-workbooks and JSON files.  This lesson starts with some background informati" />
<meta property="og:image"       content="https://hydro-informatics.github.io/_static/icon.jpg" />

<meta name="twitter:card" content="summary" />


  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/icon.jpg" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Hydro-Informatics</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <p class="caption collapsible-parent">
 <span class="caption-text">
  Get Started
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../lectures/classroom.html">
   The Virtual Classroom
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../lectures/lectures.html">
     Lectures and exercises
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../lectures/take_seat.html">
     Take a Seat in the Virtual Classroom
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../get-started/software.html">
   Software Resources
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../get-started/vm.html">
     Virtual Machines and Linux
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../get-started/vm.html#get-started-with-debian-linux">
     Get started with (Debian) Linux
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../get-started/ide.html">
     Anaconda and Integrated Development Environments (IDEs)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../get-started/git.html">
     Introduction to git
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../get-started/geo.html">
     Geospatial Software
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../get-started/install-openfoam.html">
     Install OpenFOAM
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../get-started/install-telemac.html">
     open TELEMAC (Installation)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../get-started/others.html">
     Other Software Resources
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Python Basics
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../python-basics/python.html">
   Get Started with Python
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../python-basics/pyinstall.html">
     Install Python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pybase.html">
     First steps
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pyerror.html">
     Errors, Logging, and Debugging
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pyloop.html">
     Loops and Conditional Statements
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../python-basics/modularize.html">
   Modularization &amp; Object Orientation
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="pyfun.html">
     Functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pypckg.html">
     Packages, Modules and Libraries
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="classes.html">
     Object Orientation and Classes
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 current active collapsible-parent">
  <a class="reference internal" href="../python-basics/data-handling.html">
   Data and File Handling
  </a>
  <ul class="current collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="pynum.html">
     Load and Write Basic Data Files
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pynum.html#numpy">
     NumPy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pynum.html#pandas">
     Pandas
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pynum.html#dates-and-time">
     Dates and Time
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Manipulation of Workbooks and JSON Files
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pyplot.html">
     Plotting
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="pystyle.html">
   Code Style and Conventions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="gui.html">
   Graphical User Interfaces (GUIs)
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../exercises/python-exercises.html">
   Python Exercises
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../exercises/ex-ms.html">
     1d Hydraulics (Manning-Strickler Formula)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../exercises/ex-sp.html">
     Reservoir Volume Calculation with a Sequent Peak Algorithm
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../exercises/ex-floods.html">
     Calculate flood return periods
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../exercises/ex-sediment.html">
     Cross-section Averaged Sediment Transport
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../exercises/ex-gui.html">
     Create a
     <strong>
      G
     </strong>
     raphical
     <strong>
      U
     </strong>
     ser
     <strong>
      I
     </strong>
     nterface (GUI)
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Documentation
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../documentation/documentation.html">
   Markdown and Code Documentation
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../exercises/docs-exercises.html">
   Exercises
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../exercises/ex-git.html">
     Git and markdown
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Geospatial Analysis
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../geopy/geospatial-data.html">
   Geospatial Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../geopy/use-qgis.html">
   QGIS tutorial
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../geopy/geo-python.html">
   Geospatial Python
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../geopy/geo-pckg.html">
     Geospatial Python - Open Source Packages
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="geo-shp.html">
     Shapefile (vector dataset) handling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="geo-raster.html">
     Raster (Gridded) Dataset Handling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="geo-convert.html">
     Raster to Vector Conversion and Vice Versa
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="geo-arcpy.html">
     The Commercial arcpy Library
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../exercises/geo-exercises.html">
   Exercises
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../exercises/ex-geco.html">
     Script-Create a Habitat Suitability Map
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Numerical Modeling
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../numerics/numerical-modeling.html">
   Principles
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../numerics/pre-qgis.html">
   Pre-Processing with QGIS
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../numerics/basement.html">
   BASEMENT
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../numerics/telemac.html">
   TELEMAC
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../numerics/telemac2d.html">
     Pre-Processing for TELEMAC models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../numerics/telemac3d.html">
     3d modeling with TELEMAC
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../numerics/telemac-gaia.html">
     Gaia Workflow
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../numerics/openfoam.html">
   OpenFOAM
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../numerics/calibration.html">
   Calibration and Valdiation
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Troubleshoot
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../troubleshoot/dbg-programming.html">
   Programming Tools and IDEs
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../troubleshoot/dbg-anaconda.html">
     Debugging Anaconda
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../troubleshoot/dbg-python.html">
     Debugging Python Code
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../troubleshoot/dbg-jupyter.html">
     Debugging Jupyter
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../troubleshoot/dbg-numerical-models.html">
   Numerical Models
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../troubleshoot/dbg-basement.html">
     Debugging BASEMENT
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../troubleshoot/dbg-telemac.html">
     Debugging TELEMAC/SALOME
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../troubleshoot/dbg-os.html">
   Operating Systems (Linux and VMs)
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../troubleshoot/dbg-linux.html">
     Debugging Debian Linux
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../troubleshoot/dbg-vm.html">
     Debugging Virtual Machines
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Disclaimer and License
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../terms/license.html">
   License
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../terms/disclaimer.html">
   Disclaimer
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Written by <a href="https://sebastian-schwindt.org">Sebastian Schwindt</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/jupyter/xml.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/hydro-informatics/"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        
        
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/hydro-informatics/hydro-informatics.github.io/main?filepath=jupyter/v2/gh/hydro-informatics//main?urlpath=lab/tree/hydro-informatics.github.io/tree/main/jupyter/jupyter/xml.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <button type="button" class="btn btn-secondary topbarbtn"
            onclick="initThebeSBT()" title="Launch Thebe" data-toggle="tooltip" data-placement="left"><i
                class="fas fa-play"></i><span style="margin-left: .4em;">Live Code</span></button>
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#workbook-xlsx-handling">
   Workbook (xlsx) Handling
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-a-workbook">
     Create a Workbook
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#read-and-manipulate-an-existing-workbook">
     Read and Manipulate an Existing Workbook
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#formulae-in-workbooks">
     Formulae in Workbooks
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#un-merge-cells">
     (Un)merge Cells
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#charts-plots">
     Charts (Plots)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#customize-workbook-manipulation">
     Customize Workbook Manipulation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#an-example-from-water-resources-engineering-and-research">
     An Example from Water Resources Engineering and Research
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#json">
   JSON
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#json-file-structure">
     <em>
      JSON
     </em>
     file structure
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#read-decode-and-write-encode-json-files-with-the-json-library">
     Read (Decode) and Write (Encode)
     <em>
      JSON
     </em>
     Files with the
     <code class="docutils literal notranslate">
      <span class="pre">
       json
      </span>
     </code>
     Library
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#read-decode-and-write-encode-json-files-with-pandas">
     Read (Decode) and Write (Encode)
     <em>
      JSON
     </em>
     Files with
     <em>
      pandas
     </em>
    </a>
   </li>
  </ul>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="manipulation-of-workbooks-and-json-files">
<h1>Manipulation of Workbooks and JSON Files<a class="headerlink" href="#manipulation-of-workbooks-and-json-files" title="Permalink to this headline">¶</a></h1>
<p>Summary: Create, manipulate and copy xlsx-workbooks and JSON files.</p>
<p>This lesson starts with some background information about XML and what XML has to do with workbooks and JSON: XML is the abbreviation of <a class="reference external" href="https://www.w3.org/TR/xml/"><em>E<strong>x</strong>tensible <strong>M</strong>arkup <strong>L</strong>anguage</em></a> that defines rules for encoding documents. XML was designed for straightforward usage over the internet and we encounter XML documents all the time, on websites (e.g., <em>XHTML</em>), in the shape office documents (e.g., Office Open XML such as <em>docx</em>, <em>pptx</em>, or <em>xlsx</em>), or podcasts (e.g., <em>RSS</em>). The strength of the XML format is its characteristic of being both machine-readable (i.e., a computer can process XML files) and human-readable (i.e., we can read it like a newspaper). In simple words, entering formulas in an xlsx workbook is simultaneously machine-readable and human-readable, since humans and computers can interpret and evaluate the formulas in this XML frame. Other file formats such as <a class="reference external" href="https://www.json.org/json-en.html"><em>JSON</em> (JavaScript Object Notation)</a> resemble XML and this is why we look at how <em>Python</em> can extract information from and export information to both formats. In water resources engineering and research, we are mainly interested in the exchange of information with office workbooks (<em>xlsx</em> files), or with JSON files, which provide boundary conditions for numerical models.</p>
<div class="section" id="workbook-xlsx-handling">
<h2>Workbook (xlsx) Handling<a class="headerlink" href="#workbook-xlsx-handling" title="Permalink to this headline">¶</a></h2>
<p>Why do we want to communicate with workbooks at all? We have already seen that <em>Python</em> is much more powerful than office programs for the systematic analysis of data sets. However, <em>Python</em> requires the abstraction of data fields in our minds to visualize for example the structure of a nested list. For this reason, data from and for marketing, your boss, or public authorities are often required to have visually easy-to-use workbook formats, which can be overlooked quickly. Still we want to leverage the content of such workbook information efficiently with <em>Python</em> and we want to produce visually simplistic output that anyone can read without any <em>Python</em> knowledge.</p>
<p>We have already seen that <em>pandas</em> provides easy routines for importing and exporting data from and to workbooks, respectively (<a class="reference external" href="pynum.html#pd-files">cf. the data processing &amp; file handling section</a>). <em>pandas</em> uses <a class="reference external" href="https://xlsxwriter.readthedocs.io/"><em>XlsxWriter</em></a> or <a class="reference external" href="https://openpyxl.readthedocs.io/en/stable/"><em>openpyxl</em></a> depending on what is available in the current <em>Python</em> environment*. Both packages have different behaviors, in particular when it comes to writing new or in existing workbooks. This is why the most robust approach is the direct use of one particular workbook handling library, where <em>openpyxl</em> is one of the most powerful options (note: this assertion is subjective) and this section introduces workbook handling with <em>openpyxl</em>.</p>
<p>This introduction uses the following workbook-related terms:</p>
<ul class="simple">
<li><p><strong>workbook</strong> is the main <em>xlsx</em> file we work with (also called <em>spreadsheet</em>);</p></li>
<li><p><strong>sheet</strong> is tabular content of a workbook and one workbook can have multiple sheets;</p></li>
<li><p><strong>column</strong>s are vertical lines in a sheet;</p></li>
<li><p><strong>row</strong>s are horizontal lines in a sheet;</p></li>
<li><p><strong>cell</strong>s are elements of a sheet.</p></li>
</ul>
<div class="section" id="create-a-workbook">
<h3>Create a Workbook<a class="headerlink" href="#create-a-workbook" title="Permalink to this headline">¶</a></h3>
<p><em>openpyxl</em> has a <code class="docutils literal notranslate"><span class="pre">Workbook</span></code> class that enables to create and fill workbooks with data. Typically, an instance of the <code class="docutils literal notranslate"><span class="pre">Workbook</span></code> class is called <code class="docutils literal notranslate"><span class="pre">wb</span></code> and worksheets contain the letters <code class="docutils literal notranslate"><span class="pre">ws</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">openpyxl</span> <span class="k">as</span> <span class="nn">oxl</span>
<span class="n">wb</span> <span class="o">=</span> <span class="n">oxl</span><span class="o">.</span><span class="n">Workbook</span><span class="p">()</span>  <span class="c1"># create a Workbook instance</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">wb</span><span class="o">.</span><span class="n">active</span>  <span class="c1"># activate worksheet</span>
<span class="n">ws</span><span class="o">.</span><span class="n">titel</span> <span class="o">=</span> <span class="s2">&quot;Gaussian 2D&quot;</span>  <span class="c1"># name worksheet</span>
<span class="n">ws</span><span class="p">[</span><span class="s2">&quot;A1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Gaussian sample data&quot;</span>  <span class="c1"># write to cell A1</span>

<span class="c1"># generate some data</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
<span class="n">dis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span>
<span class="n">sigma</span><span class="p">,</span> <span class="n">mu</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span>
<span class="n">gaussian</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">dis</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)))</span>

<span class="c1"># write data to worksheet</span>
<span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">gaussian</span><span class="o">.</span><span class="n">shape</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="n">j</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">gaussian</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Workbook data in cell A2: &quot;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ws</span><span class="p">[</span><span class="s2">&quot;A2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Corresponds to np.array value: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">gaussian</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>

<span class="c1"># save and close (destruct object) workbook</span>
<span class="n">wb</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;data/python_workbook.xlsx&quot;</span><span class="p">)</span>
<span class="n">wb</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Workbook data in cell A2: 0.3678794411714422
Corresponds to np.array value: 0.3678794411714422
</pre></div>
</div>
</div>
</div>
<p><img alt="img" src="https://raw.githubusercontent.com/sschwindt/hydroinformatics/main/docs/img/py-xlsx.png" /></p>
</div>
<div class="section" id="read-and-manipulate-an-existing-workbook">
<h3>Read and Manipulate an Existing Workbook<a class="headerlink" href="#read-and-manipulate-an-existing-workbook" title="Permalink to this headline">¶</a></h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When <em>openpyxl</em> opens an existing workbook, it cannot read graphical objects (e.g., graphs, shapes, or images). For this reason, saving the workbook with the same name will make graphical objects disappear.</p>
</div>
<p><em>openpyxl</em> reads existing workbooks with <code class="docutils literal notranslate"><span class="pre">openpyxl.load_workbook(filename=str())</span></code>. This function accepts optional keyword arguments, where the most important are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">read_only=BOOLEAN</span></code> decides weather a workbook is opened in <em>read only</em> mode. A workbook can only be manipulated if <code class="docutils literal notranslate"><span class="pre">read_only=False</span></code> (this is the default option, which can be useful to handle large files or to ensure that graphical objects are not lost).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">write_only=BOOLEAN</span></code> decides weather a workbook is opened in <em>write only</em> mode. If <code class="docutils literal notranslate"><span class="pre">write_only=True</span></code> (the default is <code class="docutils literal notranslate"><span class="pre">False</span></code>), no data can be read from a workbook, but writing data is significantly faster (i.e., this option is useful to write large datasets).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data_only=BOOLEAN</span></code> determines if cell formulae or cell data will be read. For example, when a workbook cell’s content is <code class="docutils literal notranslate"><span class="pre">=PI()</span></code>, <code class="docutils literal notranslate"><span class="pre">data_only=False</span></code> (this is the default option) reads the cell value as <code class="docutils literal notranslate"><span class="pre">=PI()</span></code> and <code class="docutils literal notranslate"><span class="pre">data_only=True</span></code> reads the cell value as <code class="docutils literal notranslate"><span class="pre">3.14159265359</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">keep_vba=BOOLEAN</span></code> controls whether <em>Visual Basic</em> elements (macros) are kept or not. The default is <code class="docutils literal notranslate"><span class="pre">keep_vba=False</span></code> (i.e., no preservation) and <code class="docutils literal notranslate"><span class="pre">keep_vba=True</span></code> will still not enable a modification of Visual Basic elements.</p></li>
</ul>
<p>If <code class="docutils literal notranslate"><span class="pre">read_only=False</span></code>, we can manipulate cell values and also cell formats, including data formats (e.g., date, time, and <a class="reference external" href="https://openpyxl.readthedocs.io/en/stable/_modules/openpyxl/styles/numbers.html">many more</a>), <a class="reference external" href="https://openpyxl.readthedocs.io/en/stable/styles.html">font properties (and many more cell styles)</a>, or colors in <em>HEX Color Code</em> (<a class="reference external" href="https://www.colorcodehex.com/">find your favorite color here</a>). The following example opens the above created <code class="docutils literal notranslate"><span class="pre">python_workbook.xlsx</span></code>, adds a new worksheet, illustrates the implementation of some cell styles and fills it with randomized discharge measurements.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">from</span> <span class="nn">openpyxl.styles</span> <span class="kn">import</span> <span class="n">Font</span><span class="p">,</span> <span class="n">Alignment</span><span class="p">,</span> <span class="n">PatternFill</span>
<span class="n">wb</span> <span class="o">=</span> <span class="n">oxl</span><span class="o">.</span><span class="n">load_workbook</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;data/python_workbook.xlsx&quot;</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">wb</span><span class="o">.</span><span class="n">create_sheet</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Discharge&quot;</span><span class="p">)</span>

<span class="c1"># define title styles</span>
<span class="n">title_font</span> <span class="o">=</span> <span class="n">Font</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Tahoma&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;11&quot;</span><span class="p">,</span> <span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">italic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C1D0DE&quot;</span><span class="p">)</span>
<span class="n">title_fill</span> <span class="o">=</span> <span class="n">PatternFill</span><span class="p">(</span><span class="n">fill_type</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span> <span class="n">start_color</span><span class="o">=</span><span class="s2">&quot;050505&quot;</span><span class="p">,</span> <span class="n">end_color</span><span class="o">=</span><span class="s2">&quot;073AD4&quot;</span><span class="p">)</span>
<span class="n">title_align</span> <span class="o">=</span> <span class="n">Alignment</span><span class="p">(</span><span class="n">horizontal</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">vertical</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">text_rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="n">wrap_text</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">shrink_to_fit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">date_time_format</span> <span class="o">=</span> <span class="s2">&quot;yyyy-mm-dd hh:mm:ss&quot;</span>
<span class="n">ws</span><span class="p">[</span><span class="s2">&quot;A1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Date-Time (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">date_time_format</span>

<span class="n">title_cell_flow</span> <span class="o">=</span> <span class="n">ws</span><span class="p">[</span><span class="s2">&quot;B1&quot;</span><span class="p">]</span>
<span class="n">title_cell_flow</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;Discharge (CMS)&quot;</span>
<span class="n">title_cell_flow</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">title_font</span>
<span class="n">title_cell_flow</span><span class="o">.</span><span class="n">fill</span> <span class="o">=</span> <span class="n">title_fill</span>
<span class="n">title_cell_flow</span><span class="o">.</span><span class="n">alignment</span> <span class="o">=</span> <span class="n">title_align</span>

<span class="c1"># define time period and time delta of 1 hour = 3600 seconds</span>
<span class="n">current_date_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2040</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">3600</span><span class="p">)</span>

<span class="c1"># write random discharges to workbooks</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">ws</span><span class="o">.</span><span class="n">iter_rows</span><span class="p">(</span><span class="n">min_row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">max_row</span><span class="o">=</span><span class="mi">26</span><span class="p">,</span> <span class="n">min_col</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_col</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">current_date_time</span>
    <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">number_format</span> <span class="o">=</span> <span class="n">date_time_format</span>
    <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">number_format</span> <span class="o">=</span> <span class="s2">&quot;0.00&quot;</span>
    <span class="n">current_date_time</span> <span class="o">+=</span> <span class="n">dt</span>
    
<span class="n">wb</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;data/python_workbook_reloaded.xlsx&quot;</span><span class="p">)</span>
<span class="n">wb</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p><img alt="img" src="https://raw.githubusercontent.com/sschwindt/hydroinformatics/main/docs/img/py-xlsx-reloaded.png" /></p>
<p>The below code block provides the short helper function <code class="docutils literal notranslate"><span class="pre">read_columns</span></code> to read only one or more columns into a (nested) <em>list</em> (reads until the maximum number of rows, defined by <code class="docutils literal notranslate"><span class="pre">ws.rows</span></code>, in a workbook is reached). A similar function can be written for reading rows.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">read_columns</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">start_row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;ABC&quot;</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">ws</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">{}{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">row</span><span class="p">)]</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_row</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">rows</span><span class="o">.</span><span class="n">__sizeof__</span><span class="p">())</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">]</span>

<span class="c1"># example usage:</span>
<span class="n">wb</span> <span class="o">=</span> <span class="n">oxl</span><span class="o">.</span><span class="n">load_workbook</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;data/python_workbook.xlsx&quot;</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">wb</span><span class="o">.</span><span class="n">active</span>
<span class="n">col_D</span> <span class="o">=</span> <span class="n">read_columns</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">start_row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">)</span>
<span class="n">col_F</span> <span class="o">=</span> <span class="n">read_columns</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">start_row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
<span class="n">wb</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="formulae-in-workbooks">
<h3>Formulae in Workbooks<a class="headerlink" href="#formulae-in-workbooks" title="Permalink to this headline">¶</a></h3>
<p>The optional keyword argument <code class="docutils literal notranslate"><span class="pre">data_only=False</span></code> enables reading workbook formula instead of cell values. However, not all workbook formulae are recognized by <em>openpyxl</em> and in the case of doubts, a dirty try-and-error approach is the only remedy. As an example, change <code class="docutils literal notranslate"><span class="pre">SQRT</span></code> in the below example to the formula in question.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">openpyxl.utils</span> <span class="kn">import</span> <span class="n">FORMULAE</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SQRT&quot;</span> <span class="ow">in</span> <span class="n">FORMULAE</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="un-merge-cells">
<h3>(Un)merge Cells<a class="headerlink" href="#un-merge-cells" title="Permalink to this headline">¶</a></h3>
<p>Merging and un-merging cells is a popular office function for style purposes and <em>openpyxl</em> also provides function to perform merge operations:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ws</span><span class="o">.</span><span class="n">merge_cells</span><span class="p">(</span><span class="n">start_row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">end_row</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">start_column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">end_column</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ws</span><span class="o">.</span><span class="n">unmerge_cells</span><span class="p">(</span><span class="n">start_row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">end_row</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">start_column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">end_column</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="charts-plots">
<h3>Charts (Plots)<a class="headerlink" href="#charts-plots" title="Permalink to this headline">¶</a></h3>
<p>In the unlikely event that you want to insert plots directly into workbooks (<a class="reference external" href="pyplot.html#matplotlib"><code class="docutils literal notranslate"><span class="pre">matplotlib</span></code></a> is way more powerful), <em>openpyxl</em> offers features for this purpose as well. To illustrate the creation of a an area chart, the below code block re-uses the first column of random values in the  previously created <code class="docutils literal notranslate"><span class="pre">python_workbook.xlsx</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">openpyxl.chart</span> <span class="kn">import</span> <span class="n">AreaChart</span><span class="p">,</span> <span class="n">Reference</span><span class="p">,</span> <span class="n">Series</span>

<span class="n">wb</span> <span class="o">=</span> <span class="n">oxl</span><span class="o">.</span><span class="n">load_workbook</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;data/python_workbook.xlsx&quot;</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">wb</span><span class="o">.</span><span class="n">active</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">AreaChart</span><span class="p">()</span>
<span class="n">chart</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Random Gaussian&quot;</span>
<span class="n">chart</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">chart</span><span class="o">.</span><span class="n">x_axis</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Cell row&quot;</span>
<span class="n">chart</span><span class="o">.</span><span class="n">y_axis</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Random value (-)&quot;</span>

<span class="n">col_D</span> <span class="o">=</span> <span class="n">Reference</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">min_col</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">min_row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">max_row</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">col_F</span> <span class="o">=</span> <span class="n">Reference</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">min_col</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">min_row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">max_row</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="n">chart</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="n">col_F</span><span class="p">,</span> <span class="n">titles_from_data</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">chart</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="n">col_D</span><span class="p">,</span> <span class="n">titles_from_data</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">ws</span><span class="o">.</span><span class="n">add_chart</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">&quot;B2&quot;</span><span class="p">)</span>

<span class="n">wb</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;data/python_workbook_chart.xlsx&quot;</span><span class="p">)</span>
<span class="n">wb</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p><img alt="img" src="https://raw.githubusercontent.com/sschwindt/hydroinformatics/main/docs/img/py-xlsx-plot.png" /></p>
<p>Other workbook charts are available and their implementation (still: why would you?) is explained in the <a class="reference external" href="https://openpyxl.readthedocs.io/en/stable/charts/introduction.html"><em>openpyxl</em> docs</a>.</p>
</div>
<div class="section" id="customize-workbook-manipulation">
<h3>Customize Workbook Manipulation<a class="headerlink" href="#customize-workbook-manipulation" title="Permalink to this headline">¶</a></h3>
<p>There are many ways of modifying workbooks and <em>openpyxl</em> provides close-to “shovel-ready” methods to manipulate workbooks. Still, in order to avoid re-reading this lesson every time you want to manipulate a workbook, it is much more convenient to have your own workbook manipulation classes ready. For example, use custom <code class="docutils literal notranslate"><span class="pre">Read</span></code> and <code class="docutils literal notranslate"><span class="pre">Write</span></code> classes, where <code class="docutils literal notranslate"><span class="pre">Read</span></code> is the parent class of the <code class="docutils literal notranslate"><span class="pre">Write</span></code> class (see the section on <a class="reference external" href="classes.html#inheritance">inheritance of classes</a>). The <code class="docutils literal notranslate"><span class="pre">Read</span></code> class may contain tailored functions for reading specific columns, rows, or arrays. The below code block illustrates a basic example for such <code class="docutils literal notranslate"><span class="pre">Read</span></code> and <code class="docutils literal notranslate"><span class="pre">Write</span></code> classes with the above <code class="docutils literal notranslate"><span class="pre">read_columns</span></code> function implemented as a method of the <code class="docutils literal notranslate"><span class="pre">Read</span></code> class.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">openpyxl</span> <span class="k">as</span> <span class="nn">oxl</span>

<span class="k">class</span> <span class="nc">Read</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="n">workbook_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">read_only</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;read_only&quot;</span><span class="p">)</span>
        <span class="n">data_only</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data_only&quot;</span><span class="p">)</span>
        <span class="n">sheet_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data_only&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wb</span> <span class="o">=</span> <span class="n">oxl</span><span class="o">.</span><span class="n">load_workbook</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">workbook_name</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="n">read_only</span><span class="p">,</span> <span class="n">data_only</span><span class="o">=</span><span class="n">data_only</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sheet_name</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ws</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wb</span><span class="o">.</span><span class="n">worksheets</span><span class="p">[</span><span class="n">worksheet</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ws</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wb</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">wb</span><span class="o">.</span><span class="n">sheetnames</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            
    <span class="k">def</span> <span class="nf">read_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;ABC&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">{}{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">row</span><span class="p">)]</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_row</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">column</span>
                <span class="ow">in</span> <span class="n">columns</span><span class="p">]</span>
            
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

            
<span class="k">class</span> <span class="nc">Write</span><span class="p">(</span><span class="n">Read</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="n">workbook_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">data_only</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data_only&quot;</span><span class="p">)</span>
        <span class="n">sheet_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data_only&quot;</span><span class="p">)</span>
        <span class="n">Read</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">workbook_name</span><span class="o">=</span><span class="n">workbook_name</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">data_only</span><span class="o">=</span><span class="n">data_only</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="n">sheet_name</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>An extended example script with more complex <code class="docutils literal notranslate"><span class="pre">Read</span></code> and <code class="docutils literal notranslate"><span class="pre">Write</span></code> classes can be downloaded from the <a class="reference external" href="https://github.com/hydro-informatics/material-py-codes/raw/master/workbooks/xlsx.py">course repository</a> (please note that this script is only temporary available when the course takes place).</p>
<div class="admonition-challenge admonition">
<p class="admonition-title">Challenge</p>
<p>What are your favorite fonts, table colors and layouts? Write your own <code class="docutils literal notranslate"><span class="pre">Read</span></code> and <code class="docutils literal notranslate"><span class="pre">Write</span></code> classes with formatting methods to have a personal template ready to be used at any time.</p>
</div>
</div>
<div class="section" id="an-example-from-water-resources-engineering-and-research">
<h3>An Example from Water Resources Engineering and Research<a class="headerlink" href="#an-example-from-water-resources-engineering-and-research" title="Permalink to this headline">¶</a></h3>
<p>The ecological restoration or enhancement of rivers requires, among other data, information on preferred water depths and flow velocities of target fish species. This information is established by biologists and then often provided in the shape of so-called <a class="reference external" href="https://riverarchitect.github.io/RA_wiki/SHArC#hefish">habitat suitability index (HSI)</a> curves in workbook formats. As water resources researchers and engineers, we produce geospatially explicit data of water depth and flow velocity with numerical models. The output of two- or three-dimensional numerical models is way too large for being handled with office applications. So we need an advanced tool such as <em>Python</em> to handle the geospatially explicit data and to read and interpolate HSI curves from workbooks. How does that look like technically? The course assignments will help you to find out …</p>
<div class="admonition-exercise admonition">
<p class="admonition-title">Exercise</p>
<p>Get more familiar with workbook handling in the <a class="reference internal" href="../exercises/ex-sediment.html"><span class="doc std std-doc">Sediment transport (1d)</span></a> exercise.</p>
</div>
</div>
</div>
<div class="section" id="json">
<h2>JSON<a class="headerlink" href="#json" title="Permalink to this headline">¶</a></h2>
<p>JavaScript Object Notation (<a class="reference external" href="https://www.json.org/json-en.html">JSON</a>) files have a similar structure to XML and enable the structured storage of (human-readable) data. For example, the numerical code <em>BASEMENT v.3.x</em> (<a class="reference internal" href="../numerics/basement.html"><span class="doc std std-doc">read more in the numerical modelling chapter</span></a>) uses a <em>model.json</em> and a <em>simulation.json</em> file to store model setup parameters such as material properties. In water resources engineering and research, we often want to automate running numerical models, which involves the optimization of model parameters stored in <em>json</em> files. This is where <em>Python</em> steps in with the <code class="docutils literal notranslate"><span class="pre">JSON</span></code> package and <code class="docutils literal notranslate"><span class="pre">pandas</span></code>’ <em>JSON</em> modules.</p>
<div class="section" id="json-file-structure">
<h3><em>JSON</em> file structure<a class="headerlink" href="#json-file-structure" title="Permalink to this headline">¶</a></h3>
<p>A <em>JSON</em> file consists of two types of data structures, which are <em>dictionary</em> objects and <em>array</em>s in the form of <em>lists</em> of values. The <em>dictionary</em> objects in a <em>JSON</em> file correspond to the same format that we already know in <em>Python</em>: Pairs of keys (names) and values embraced by curly brackets (<em>braces</em>) <code class="docutils literal notranslate"><span class="pre">{&quot;name&quot;:</span> <span class="pre">value}</span></code>. The <code class="docutils literal notranslate"><span class="pre">value</span></code> can be a <em>string</em>, <em>numeric</em>, a comm-separated <em>list</em> <code class="docutils literal notranslate"><span class="pre">[]</span></code> (<em>array</em>) of data, or another <em>dictionary</em>.
The following example shows a <em>JSON</em> file called <code class="docutils literal notranslate"><span class="pre">river_struct.json</span></code> with a <code class="docutils literal notranslate"><span class="pre">RIVER</span></code> key that has a nested dictionary as value. The value-<em>dictionary</em> contains three keys (<code class="docutils literal notranslate"><span class="pre">NAME</span></code>, <code class="docutils literal notranslate"><span class="pre">GEOMETRY</span></code>, and <code class="docutils literal notranslate"><span class="pre">HYDRAULICS</span></code>.</p>
<blockquote>
<div><p><em><strong>Tip</strong></em>: Take a couple of minutes to understand the elements of <code class="docutils literal notranslate"><span class="pre">river_struct.json</span></code>.<br>
What is the purpose of the <code class="docutils literal notranslate"><span class="pre">FLOWBOUNDARIES</span></code> in <code class="docutils literal notranslate"><span class="pre">GEOMETRY</span></code>? <br>
How could the <code class="docutils literal notranslate"><span class="pre">FLOWBOUNDARIES</span></code> be related to the <code class="docutils literal notranslate"><span class="pre">BOUNDARY</span></code> key of <code class="docutils literal notranslate"><span class="pre">HYDRAULICS</span></code>?<br>
What units could the <code class="docutils literal notranslate"><span class="pre">FRICTION</span></code> values correspond to?<br>
Can you find the river on a map?</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
	<span class="s2">&quot;RIVER&quot;</span><span class="p">:</span> <span class="p">{</span>
		<span class="s2">&quot;NAME&quot;</span><span class="p">:</span> <span class="s2">&quot;Vanilla Flow&quot;</span><span class="p">,</span>
		<span class="s2">&quot;GEOMETRY&quot;</span><span class="p">:</span> <span class="p">{</span>
			<span class="s2">&quot;REGIONS&quot;</span><span class="p">:</span> <span class="p">[</span>
				<span class="p">{</span>
				  <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;wet&quot;</span><span class="p">,</span>
				  <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;riverbed&quot;</span>
				<span class="p">},</span>
				<span class="p">{</span>
				  <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;dry&quot;</span><span class="p">,</span>
				  <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;floodplain&quot;</span>
				<span class="p">}</span>
			<span class="p">],</span>
			<span class="s2">&quot;FLOWBOUNDARIES&quot;</span><span class="p">:</span> <span class="p">[</span>
				<span class="p">{</span>
				  <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Inflow&quot;</span><span class="p">,</span>
				  <span class="s2">&quot;nodes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">31</span><span class="p">]</span>
				<span class="p">},</span>
				<span class="p">{</span>
				  <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Outflow&quot;</span><span class="p">,</span>
				  <span class="s2">&quot;nodes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">89</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">69</span><span class="p">,</span> <span class="mi">95</span><span class="p">]</span>
				<span class="p">}</span>
			<span class="p">]</span>
		<span class="p">},</span>
		<span class="s2">&quot;HYDRAULICS&quot;</span><span class="p">:</span> <span class="p">{</span>
			<span class="s2">&quot;BOUNDARY&quot;</span><span class="p">:</span> <span class="p">[</span>
				<span class="p">{</span>
					<span class="s2">&quot;discharge_file&quot;</span><span class="p">:</span> <span class="s2">&quot;/simulation/directory/Inflow.txt&quot;</span><span class="p">,</span>
					<span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Inflow&quot;</span><span class="p">,</span>
					<span class="s2">&quot;slope&quot;</span><span class="p">:</span> <span class="mf">0.005</span><span class="p">,</span>
					<span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;hydrograph&quot;</span>
				<span class="p">},</span>
				<span class="p">{</span>
					<span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Outflow&quot;</span><span class="p">,</span>
					<span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;zero_gradient&quot;</span>
				<span class="p">}</span>
			<span class="p">],</span>
			<span class="s2">&quot;FRICTION&quot;</span><span class="p">:</span> <span class="p">{</span>
				<span class="s2">&quot;cobble&quot;</span><span class="p">:</span> <span class="mf">20.0</span><span class="p">,</span>
				<span class="s2">&quot;gravel&quot;</span><span class="p">:</span> <span class="mf">26.0</span><span class="p">,</span>
				<span class="s2">&quot;sand&quot;</span><span class="p">:</span> <span class="mi">41</span>
			<span class="p">}</span>
		<span class="p">},</span>
		<span class="s2">&quot;LOCATION&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">48.744079</span><span class="p">,</span> <span class="mf">9.103928</span><span class="p">]</span>
	<span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;RIVER&#39;: {&#39;NAME&#39;: &#39;Vanilla Flow&#39;,
  &#39;GEOMETRY&#39;: {&#39;REGIONS&#39;: [{&#39;type&#39;: &#39;wet&#39;, &#39;name&#39;: &#39;riverbed&#39;},
    {&#39;type&#39;: &#39;dry&#39;, &#39;name&#39;: &#39;floodplain&#39;}],
   &#39;FLOWBOUNDARIES&#39;: [{&#39;name&#39;: &#39;Inflow&#39;, &#39;nodes&#39;: [1, 3, 7, 31]},
    {&#39;name&#39;: &#39;Outflow&#39;, &#39;nodes&#39;: [89, 90, 76, 69, 95]}]},
  &#39;HYDRAULICS&#39;: {&#39;BOUNDARY&#39;: [{&#39;discharge_file&#39;: &#39;/simulation/directory/Inflow.txt&#39;,
     &#39;name&#39;: &#39;Inflow&#39;,
     &#39;slope&#39;: 0.005,
     &#39;type&#39;: &#39;hydrograph&#39;},
    {&#39;name&#39;: &#39;Outflow&#39;, &#39;type&#39;: &#39;zero_gradient&#39;}],
   &#39;FRICTION&#39;: {&#39;cobble&#39;: 20.0, &#39;gravel&#39;: 26.0, &#39;sand&#39;: 41}},
  &#39;LOCATION&#39;: [48.744079, 9.103928]}}
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="read-decode-and-write-encode-json-files-with-the-json-library">
<h3>Read (Decode) and Write (Encode) <em>JSON</em> Files with the <code class="docutils literal notranslate"><span class="pre">json</span></code> Library<a class="headerlink" href="#read-decode-and-write-encode-json-files-with-the-json-library" title="Permalink to this headline">¶</a></h3>
<p><em>JSON</em> files can be implemented in many programming languages including <em>HTML</em> and <em>Python</em>. This is also the reason why <em>Jupyter</em> notebooks (as used in this course) can be run in <em>Python</em> and displayed as a web page. <em>Python</em> has a built-in <code class="docutils literal notranslate"><span class="pre">json</span></code> library that enables <em>JSON</em> decoding and encoding. The <code class="docutils literal notranslate"><span class="pre">json</span></code> library provides a <code class="docutils literal notranslate"><span class="pre">json.dumps(DATA)</span></code> method to “dump” (i.e., encode) data in <em>JSON</em> format. Vice versa, the <code class="docutils literal notranslate"><span class="pre">json.load()</span></code> method reads data from <em>JSON</em> files. The following example illustrates encoding and decoding an arbitrary nested dataset with the <code class="docutils literal notranslate"><span class="pre">json</span></code> library.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="c1"># create arbitrary nested data (list, dictionary, tuple)</span>
<span class="n">data_for_json</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;list_element1&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;dict_key&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;tuple_element&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)}]</span>

<span class="c1"># create a json file</span>
<span class="n">json_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;data/my-first.json&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w+&quot;</span><span class="p">)</span>
<span class="c1"># encode the random nested data list in json format and write to file</span>
<span class="n">json_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data_for_json</span><span class="p">))</span>
<span class="c1"># close file</span>
<span class="n">json_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># re-open the json file to read data</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;data/my-first.json&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">re_opened_file</span><span class="p">:</span>
    <span class="n">raw_data</span> <span class="o">=</span> <span class="n">re_opened_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>

<span class="c1"># decode json data in a Python variable</span>
<span class="n">data_from_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">raw_data</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data_from_json</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&quot;list_element1&quot;, {&quot;dict_key&quot;: [&quot;tuple_element&quot;, &quot;text&quot;, 1.0, null]}]
</pre></div>
</div>
</div>
</div>
<p>The <a class="reference external" href="https://docs.python.org/3/library/json.html"><em>Python</em> docs</a> provide more options and descriptions on using the <code class="docutils literal notranslate"><span class="pre">json</span></code> library. However, here we will (once again) make use of the <em>pandas</em> library, which offers some powerful features for handling json data.</p>
</div>
<div class="section" id="read-decode-and-write-encode-json-files-with-pandas">
<span id="read-json"></span><h3>Read (Decode) and Write (Encode) <em>JSON</em> Files with <em>pandas</em><a class="headerlink" href="#read-decode-and-write-encode-json-files-with-pandas" title="Permalink to this headline">¶</a></h3>
<p><em>pandas</em> (recall <a class="reference external" href="pynum.html#pandas">data and file handling</a>) enables reading <em>JSON</em> files into its convenient table format with an embedded usage of the <code class="docutils literal notranslate"><span class="pre">json</span></code> library.
The following code block uses the <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_json.html"><code class="docutils literal notranslate"><span class="pre">pandas.read_json(FILE)</span></code></a> method to read the above shown <code class="docutils literal notranslate"><span class="pre">RIVER</span></code> sample file.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">river</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="s2">&quot;data/river_struct.json&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">river</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                        RIVER
GEOMETRY    {&#39;REGIONS&#39;: [{&#39;type&#39;: &#39;wet&#39;, &#39;name&#39;: &#39;riverbed...
HYDRAULICS  {&#39;BOUNDARY&#39;: [{&#39;discharge_file&#39;: &#39;/simulation/...
LOCATION                                [48.744079, 9.103928]
NAME                                             Vanilla Flow
</pre></div>
</div>
</div>
</div>
<p>Since a river without data is like ice cream without taste, we will add (random) data of flow characteristics to the data structure. Let us assume that we have used the data from <code class="docutils literal notranslate"><span class="pre">river_struct.json</span></code> to simulate a stationary discharge in a two-dimensional numerical model. As a result we have two regular grids (arrays) with data on flow velocity and flow depth. Now, we want to append both the flow depth and flow velocity arrays in the form of a result structure (dictionary) in the <code class="docutils literal notranslate"><span class="pre">river_struct.json</span></code> and give the river a new name.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create random data</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">weibull</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">weibull</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

<span class="c1"># append RESULTS row to pandas dataframe</span>
<span class="n">river_dict</span> <span class="o">=</span> <span class="n">river</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
<span class="n">river_dict</span><span class="p">[</span><span class="s2">&quot;RIVER&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;RESULTS&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;flow_depth&quot;</span><span class="p">:</span> <span class="n">h</span><span class="p">,</span> <span class="s2">&quot;flow_velocity&quot;</span><span class="p">:</span> <span class="n">u</span><span class="p">}})</span>
<span class="n">updated_river</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">river_dict</span><span class="p">)</span>

<span class="c1"># re-NAME RIVER</span>
<span class="n">updated_river</span><span class="p">[</span><span class="s2">&quot;RIVER&quot;</span><span class="p">][</span><span class="s2">&quot;NAME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Honey river&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">updated_river</span><span class="p">)</span>

<span class="c1"># export to JSON</span>
<span class="n">updated_river</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s2">&quot;data/river_results.json&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                        RIVER
GEOMETRY    {&#39;REGIONS&#39;: [{&#39;type&#39;: &#39;wet&#39;, &#39;name&#39;: &#39;riverbed...
HYDRAULICS  {&#39;BOUNDARY&#39;: [{&#39;discharge_file&#39;: &#39;/simulation/...
LOCATION                                [48.744079, 9.103928]
NAME                                              Honey river
RESULTS     {&#39;flow_depth&#39;: [[0.0, 0.48517059208747887, 1.0...
</pre></div>
</div>
</div>
</div>
<p><img alt="img" src="https://raw.githubusercontent.com/sschwindt/hydroinformatics/main/docs/img/py-json-file.png" /></p>
<div class="admonition-exercise admonition">
<p class="admonition-title">Exercise</p>
<p>Get more familiar with <em>JSON</em> file handling in the <a class="reference internal" href="../exercises/ex-geco.html"><span class="doc std std-doc">geospatial ecohydraulics</span></a> exercise (requires understanding the chapter on geospatial <em>Python</em>).</p>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "hydro-informatics/",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./jupyter"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="pynum.html" title="previous page">Load and Write Basic Data Files</a>
    <a class='right-next' id="next-link" href="pyplot.html" title="next page">Plotting</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Sebastian Schwindt<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>